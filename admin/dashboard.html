<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Vercel Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
    
    <!-- Vercel Speed Insights -->
    <script defer src="/_vercel/speed-insights/script.js"></script>
    
    <title>Admin Dashboard - Eastlake Wolfpack Association</title>
    <link rel="stylesheet" href="dashboard.css">
    <style>
        /* File upload styles */
        .file-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f9f9f9;
            transition: border-color 0.3s ease;
        }
        
        .file-upload-container:hover {
            border-color: #007bff;
        }
        
        .file-upload-container input[type="file"] {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .file-upload-info {
            color: #666;
        }
        
        .file-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .file-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .file-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .file-link {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }
        
        .file-link:hover {
            text-decoration: underline;
        }
        
        .no-file {
            color: #6c757d;
            font-style: italic;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #888;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1><div class="logo"></div>EWA Admin Dashboard</h1>
        <div class="header-buttons">
            <a href="../index.html" class="home-btn">Home</a>
            <div id="userButtonContainer"></div>
        </div>
    </div>
    
    <div class="admin-container">
        <div class="sidebar">
            <ul class="sidebar-nav" id="sidebarNav">
                <li><a href="#dashboard" class="nav-link active" data-section="dashboard">Dashboard</a></li>
                <li class="admin-only"><a href="#officers" class="nav-link" data-section="officers">Officer Management</a></li>
                <li class="admin-only"><a href="#club-websites" class="nav-link" data-section="club-websites">Club Website Links</a></li>
                <li><a href="#volunteers" class="nav-link" data-section="volunteers">Volunteer Signup Management</a></li>
                <li class="admin-only"><a href="#news" class="nav-link" data-section="news">News & Announcements</a></li>
                <li class="admin-only"><a href="#links" class="nav-link" data-section="links">Links & Resources</a></li>
                <li><a href="#insurance" class="nav-link" data-section="insurance">Insurance Forms</a></li>
                            <li><a href="#1099" class="nav-link" data-section="1099">1099 Information</a></li>
            <li><a href="#profile" class="nav-link" data-section="profile">Security Settings</a></li>
            <li class="admin-only"><a href="#security-dashboard" class="nav-link" data-section="security-dashboard">Security Dashboard</a></li>
            <li class="admin-only"><a href="#analytics" class="nav-link" data-section="analytics">Analytics & Reports</a></li>
                                           <li class="admin-only"><a href="#content" class="nav-link" data-section="content">Content Management</a></li>
                               <li class="admin-only"><a href="#users" class="nav-link" data-section="users">User Management</a></li>
                               <li class="admin-only"><a href="#backup" class="nav-link" data-section="backup">Backup Management</a></li>
            </ul>
        </div>
        
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2>Dashboard Overview</h2>
                    <p>Welcome to the EWA Admin Dashboard. Manage your booster clubs, content, and analytics from here.</p>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Total Booster Clubs</h3>
                        <div class="stat-number">22</div>
                        <div class="stat-label">Active clubs</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Total Officers</h3>
                        <div class="stat-number" id="totalOfficers">Loading...</div>
                        <div class="stat-label">Registered officers</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Pending Documents</h3>
                        <div class="stat-number" id="pendingDocuments">Loading...</div>
                        <div class="stat-label">1099 forms due</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Site Visitors</h3>
                        <div class="stat-number" id="siteVisitors">N/A</div>
                        <div class="stat-label">Analytics not configured</div>
                    </div>
                </div>
                
                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <a href="#officers" class="action-btn nav-link" data-section="officers">Add New Officer</a>
                        <a href="#news" class="action-btn nav-link" data-section="news">Post News</a>
                        <a href="#documents" class="action-btn nav-link" data-section="documents">Review Documents</a>
                        <a href="#analytics" class="action-btn secondary nav-link" data-section="analytics">View Reports</a>
                    </div>
                </div>
                
                <div class="recent-activity">
                    <h3>Recent Activity</h3>
                    <div class="activity-item">
                        <div class="activity-time">2 hours ago</div>
                        <div class="activity-text">New officer added to EHS Band Boosters</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">1 day ago</div>
                        <div class="activity-text">1099 form submitted by EHS Football Boosters</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">2 days ago</div>
                        <div class="activity-text">News post published: "Spring Sports Registration"</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">3 days ago</div>
                        <div class="activity-text">New link added: "Eastlake Athletics Calendar"</div>
                    </div>
                </div>
            </div>
            
            <!-- Officer Management Section -->
            <div id="officers" class="content-section">
                <div class="section-header">
                    <h2>Officer Management</h2>
                    <p>Manage booster club officers and import data from spreadsheets.</p>
                </div>
                
                <div class="form-section">
                    <h3>Import Officer Data</h3>
                    <div class="form-group">
                        <label for="spreadsheet">Upload Spreadsheet (CSV/Excel)</label>
                        <input type="file" id="spreadsheet" accept=".csv,.xlsx,.xls">
                    </div>
                    <div class="form-row">
                        <button class="action-btn" onclick="importOfficerData()">Import Data</button>
                        <button class="action-btn" onclick="downloadOfficerTemplate()" style="background-color: #28a745;">Download Template</button>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Add New Officer</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="officerName">Name</label>
                            <input type="text" id="officerName" placeholder="Officer Name">
                        </div>
                        <div class="form-group">
                            <label for="officerPosition">Position</label>
                            <input type="text" id="officerPosition" placeholder="President, Treasurer, etc.">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="officerEmail">Email *</label>
                            <input type="email" id="officerEmail" placeholder="officer@example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="officerPhone">Phone (optional)</label>
                            <input type="tel" id="officerPhone" placeholder="(425) 555-0101">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="boosterClub">Booster Club</label>
                        <select id="boosterClub">
                            <option value="">Select Booster Club</option>
                            <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                            <option value="EHS Band Boosters">EHS Band Boosters</option>
                            <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                            <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                            <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                            <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                            <option value="Eastlake Choir">Eastlake Choir</option>
                            <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                            <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                            <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                            <option value="Eastlake Drama">Eastlake Drama</option>
                            <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                            <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                            <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                            <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                            <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                            <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                            <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                            <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                            <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                            <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                            <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                            <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                        </select>
                    </div>
                    <button class="action-btn" onclick="addOfficer()">Add Officer</button>
                </div>
                
                <div class="form-section">
                    <h3>Current Officers</h3>
                    <div id="officersTableContainer">
                        <table class="data-table" id="officersTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Position</th>
                                    <th>Club</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="officersTableBody">
                                <!-- Officers will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Club Website Links Section -->
            <div id="club-websites" class="content-section">
                <div class="section-header">
                    <h2>Club Website Links Management</h2>
                    <p>Manage website links for each booster club. These links appear as "Visit Website" buttons on the main page.</p>
                </div>
                
                <div class="form-section">
                    <h3>Edit Club Website Links</h3>
                    <div class="form-group">
                        <label for="websiteClubSelect">Select Club</label>
                        <select id="websiteClubSelect">
                            <option value="">Select Booster Club</option>
                            <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                            <option value="EHS Band Boosters">EHS Band Boosters</option>
                            <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                            <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                            <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                            <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                            <option value="Eastlake Choir">Eastlake Choir</option>
                            <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                            <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                            <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                            <option value="Eastlake Drama">Eastlake Drama</option>
                            <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                            <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                            <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                            <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                            <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                            <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                            <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                            <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                            <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                            <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                            <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                            <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="websiteUrl">Website URL</label>
                        <input type="url" id="websiteUrl" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="websiteEnabled">
                            <input type="checkbox" id="websiteEnabled" checked>
                            Enable "Visit Website" button for this club
                        </label>
                    </div>
                    <button class="action-btn" onclick="updateWebsiteLink()">Update Website Link</button>
                </div>
                
                <div class="form-section">
                    <h3>Current Website Links</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Club Name</th>
                                <th>Website URL</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="websiteLinksTableBody">
                            <!-- Website links will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Volunteer Management Section -->
            <div id="volunteers" class="content-section">
                <div class="section-header">
                    <h2>Volunteer Management</h2>
                    <p>View and manage volunteer interest submissions for your booster club.</p>
                </div>
                
                <div class="form-section">
                    <h3>Filter Volunteers</h3>
                    <div class="form-group">
                        <label for="volunteerClubFilter">Filter by Club</label>
                        <select id="volunteerClubFilter">
                            <option value="">All Clubs</option>
                            <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                            <option value="EHS Band Boosters">EHS Band Boosters</option>
                            <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                            <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                            <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                            <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                            <option value="Eastlake Choir">Eastlake Choir</option>
                            <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                            <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                            <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                            <option value="Eastlake Drama">Eastlake Drama</option>
                            <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                            <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                            <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                            <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                            <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                            <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                            <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                            <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                            <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                            <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                            <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                            <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="volunteerStatusFilter">Filter by Status</label>
                        <select id="volunteerStatusFilter">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="contacted">Contacted</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="declined">Declined</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Volunteer Submissions</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Booster Club</th>
                                <th>Volunteer Name</th>
                                <th>Child's Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                                            <tbody>
                        <!-- Volunteer data will be loaded dynamically -->
                    </tbody>
                    </table>
                </div>
                
                <div class="form-section">
                    <h3>Export Volunteer Data</h3>
                    <p>Download volunteer submissions for your club in CSV format.</p>
                    <button class="action-btn" onclick="exportVolunteerData()">Export to CSV</button>
                </div>
            </div>
            
            <!-- News Management Section -->
            <div id="news" class="content-section">
                <div class="section-header">
                    <h2>News & Announcements</h2>
                    <p>Manage news posts and meeting minutes.</p>
                </div>
                
                <div class="form-section">
                    <h3>Add News Post</h3>
                    <div class="form-group">
                        <label for="newsTitle">Title</label>
                        <input type="text" id="newsTitle" placeholder="News Title">
                    </div>
                    <div class="form-group">
                        <label for="newsContent">Content</label>
                        <textarea id="newsContent" placeholder="News content..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="newsDate">Date</label>
                        <input type="date" id="newsDate">
                    </div>
                    <button class="action-btn">Publish News</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Title</th>
                            <th>Content</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-01-15</td>
                            <td>Next Board Meeting - January 20th</td>
                            <td>Join us for our monthly board meeting...</td>
                            <td>
                                <button class="btn-small">Edit</button>
                                <button class="btn-small">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Links Management Section -->
            <div id="links" class="content-section">
                <div class="section-header">
                    <h2>Links & Resources</h2>
                    <p>Manage external links and track their usage.</p>
                </div>
                
                <div class="form-section">
                    <h3>Add New Link</h3>
                    <div class="form-group">
                        <label for="linkTitle">Title</label>
                        <input type="text" id="linkTitle" placeholder="Link Title">
                    </div>
                    <div class="form-group">
                        <label for="linkUrl">URL</label>
                        <input type="url" id="linkUrl" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="linkCategory">Category</label>
                        <select id="linkCategory">
                            <option value="athletics">Athletics</option>
                            <option value="calendar">Calendar</option>
                            <option value="resources">Resources</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button class="action-btn">Add Link</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>URL</th>
                            <th>Category</th>
                            <th>Clicks</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Eastlake Athletics Schedule</td>
                            <td>https://www.lwsd.org/schools/eastlake/athletics</td>
                            <td>Athletics</td>
                            <td>156</td>
                            <td>
                                <button class="btn-small">Edit</button>
                                <button class="btn-small">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Insurance Forms Section -->
            <div id="insurance" class="content-section">
                <div class="section-header">
                    <h2>Insurance Forms</h2>
                    <p>Submit event and activity information for insurance purposes.</p>
                </div>
                
                <div class="form-section">
                    <h3>Submit Insurance Form</h3>
                    <div class="form-group">
                        <label for="insuranceBoosterClub">Booster Club *</label>
                        <select id="insuranceBoosterClub" required>
                            <option value="">Select Booster Club</option>
                            <option value="5c5d9238-dc96-4ad0-b6fe-6282b06573bc">EHS Band Boosters</option>
                            <option value="f2efccc3-4dbe-4eeb-b65e-ba7e7149c740">EWA Eastlake Wolfpack Association</option>
                            <option value="99367bd3-c24a-42cd-b581-35f36a29ef49">Eastlake Baseball Club</option>
                            <option value="bc3e4b83-e9a7-47ca-b7a9-56e1b4843f66">Eastlake Boys Basketball Booster Club</option>
                            <option value="c8e4f06d-c49a-4126-93aa-fcf10c5858aa">Eastlake Boys Lacrosse Booster Club</option>
                            <option value="47d6a7c1-128d-4719-b002-ae34d9012619">Eastlake Boys Soccer Booster Club</option>
                            <option value="4d60931c-5c2a-47d2-ae4a-e37192294f7e">Eastlake Boys Swimming Booster Club</option>
                            <option value="dd90f01f-bc8d-4e8d-864d-605c01cd37b9">Eastlake Boys Tennis Booster Club</option>
                            <option value="d2d3fcd3-822b-4466-bbd3-49d55c4fb0bd">Eastlake Cheer Booster Club</option>
                            <option value="40595908-c00e-4d87-a79a-566aa4869715">Eastlake Choir</option>
                            <option value="ce376909-2bb7-402e-874a-3f542463602a">Eastlake Cross-Country Boosters</option>
                            <option value="fb289ef9-3f94-4145-b1df-55fafd4362cb">Eastlake Drama</option>
                            <option value="40733b78-7d7c-44b8-a713-f5fbfb2ffefb">Eastlake Fastpitch (Girls)</option>
                            <option value="ffdd6b26-5310-4e97-8dc6-f26031533ef9">Eastlake Football Booster Club</option>
                            <option value="1dcc6157-a3f6-46f3-a50f-23cde148b58b">Eastlake Girls Basketball Booster Club</option>
                            <option value="69e7da81-8f14-46dd-b582-26404dfb6662">Eastlake Girls Lacrosse Booster Club</option>
                            <option value="933845bd-6e1a-47e0-a3df-e3a7123b3260">Eastlake Girls Soccer Booster Club</option>
                            <option value="4053c0cb-5959-4379-80f0-e82998225318">Eastlake Girls Swimming Booster Club</option>
                            <option value="dd88e4ea-620e-4c45-833d-dcda2c55bd4a">Eastlake Girls Tennis Booster Club</option>
                            <option value="05d21d4b-4149-4b7f-9e20-dfa3864f60dd">Eastlake Orchestra Booster Club</option>
                            <option value="6e69b02b-e467-4879-a7ba-16429e651a53">Eastlake Track & Field Booster Club</option>
                            <option value="b926f783-1f1e-41ae-a94a-fdccac50e3f8">Eastlake Volleyball Booster Club</option>
                            <option value="5b09a2d8-a942-473d-9270-49f13c1b36c3">Eastlake Wrestling Booster Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="insuranceEventName">Event/Activity Name</label>
                        <input type="text" id="insuranceEventName" placeholder="Event Name">
                    </div>
                    <div class="form-group">
                        <label for="insuranceEventDate">Event Date</label>
                        <input type="date" id="insuranceEventDate">
                    </div>
                    <div class="form-group">
                        <label for="insuranceEventDescription">Event Description</label>
                        <textarea id="insuranceEventDescription" placeholder="Describe the event, activities, and any special requirements..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="insuranceParticipantCount">Expected Participants</label>
                        <input type="number" id="insuranceParticipantCount" placeholder="Number of participants" min="1" oninput="validateParticipantCount(this)">
                        <div id="participantCountError" class="error-message" style="display: none; color: #dc3545; font-size: 12px; margin-top: 5px;"></div>
                    </div>
                    <button class="action-btn" onclick="submitInsuranceForm()">Submit Insurance Form</button>
                </div>
                
                <div class="form-section">
                    <h3>Your Insurance Submissions</h3>
                    <table class="data-table" id="insuranceTable">
                        <thead>
                            <tr>
                                <th>Date Submitted</th>
                                <th>Booster Club</th>
                                <th>Event Name</th>
                                <th>Event Date</th>
                                <th>Description</th>
                                <th>Participants</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- 1099 Information Section -->
            <div id="1099" class="content-section">
                <div class="section-header">
                    <h2>1099 Information</h2>
                    <p>Submit 1099 information for vendors and contractors.</p>
                </div>
                
                <div class="form-section">
                    <h3>Submit 1099 Information</h3>
                    <div class="form-group">
                        <label for="1099RecipientName">Recipient Name *</label>
                        <input type="text" id="1099RecipientName" placeholder="Recipient Name" required>
                    </div>
                    <div class="form-group">
                        <label for="1099RecipientTin">Tax ID (SSN or EIN) *</label>
                        <input type="text" id="1099RecipientTin" placeholder="123-45-6789 or 12-3456789" required>
                    </div>
                    <div class="form-group">
                        <label for="1099Amount">Payment Amount *</label>
                        <input type="number" id="1099Amount" placeholder="0.00" step="0.01" min="0" required oninput="validatePaymentAmount(this)">
                        <div id="amountError" class="error-message" style="display: none; color: #dc3545; font-size: 12px; margin-top: 5px;"></div>
                    </div>
                    <div class="form-group">
                        <label for="1099Description">Description</label>
                        <textarea id="1099Description" placeholder="Description of services or goods" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="1099BoosterClub">Booster Club *</label>
                        <select id="1099BoosterClub" required>
                            <option value="">Select Booster Club</option>
                            <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                            <option value="EHS Band Boosters">EHS Band Boosters</option>
                            <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                            <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                            <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                            <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                            <option value="Eastlake Choir">Eastlake Choir</option>
                            <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                            <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                            <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                            <option value="Eastlake Drama">Eastlake Drama</option>
                            <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                            <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                            <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                            <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                            <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                            <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                            <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                            <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                            <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                            <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                            <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                            <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="1099TaxYear">Calendar Year *</label>
                        <select id="1099TaxYear" required>
                            <option value="">Select Calendar Year</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    
                    <!-- W9 File Upload Section -->
                    <div class="form-group">
                        <label for="1099W9File">W9 Form Upload *</label>
                        <div class="file-upload-container">
                            <input type="file" id="1099W9File" accept=".pdf,.jpg,.jpeg,.png,.gif" required>
                            <div class="file-upload-info">
                                <small>Accepted formats: PDF, JPG, PNG, GIF (Max 10MB)</small>
                                <div id="w9FileStatus" class="file-status"></div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="submit1099Form()" id="submit1099Btn">Submit 1099 Information</button>
                </div>
                
                <div class="form-section">
                    <h3>Your 1099 Submissions</h3>
                    
                    <!-- Filter and Export Controls -->
                    <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <label for="yearFilter" style="font-weight: bold; margin-right: 5px;">Filter by Year:</label>
                            <select id="yearFilter" onchange="filter1099ByYear()" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">All Years</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                        
                        <button class="action-btn" onclick="load1099Data()" id="load1099Btn" style="background-color: #17a2b8;">
                            üìä Load Data
                        </button>
                        
                        <button class="action-btn" onclick="refresh1099Data()" id="refresh1099Btn" style="background-color: #007bff;">
                            üîÑ Refresh Submissions
                        </button>
                        
                        <button class="action-btn" onclick="exportSelected1099()" id="export1099Btn" style="background-color: #28a745; margin-right: 10px;">
                            üìä Export Selected (CSV)
                        </button>
                        
                        <button class="action-btn" onclick="downloadSelectedW9()" id="downloadW9Btn" style="background-color: #ffc107; color: #000; margin-right: 10px;">
                            üìÅ Download W9 Files (ZIP)
                        </button>
                        
                        <span style="font-size: 14px; color: #666;">
                            Select items to export or download W9 files
                        </span>
                    </div>
                    <table class="data-table" id="1099Table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll1099" onchange="toggleSelectAll1099()"></th>
                                <th>Date Submitted</th>
                                <th>Recipient Name</th>
                                <th>Tax ID</th>
                                <th>Amount</th>
                                <th>Calendar Year</th>
                                <th>Booster Club</th>
                                <th>W9 Form</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Analytics Section -->
            <div id="analytics" class="content-section">
                <div class="section-header">
                    <h2>Analytics & Reports</h2>
                    <p>View site usage statistics and generate reports.</p>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Page Views</h3>
                        <div class="stat-number">5,234</div>
                        <div class="stat-label">This month</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Unique Visitors</h3>
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">This month</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Most Popular Page</h3>
                        <div class="stat-number">Home</div>
                        <div class="stat-label">2,156 views</div>
                    </div>
                    
                    <div class="dashboard-card">
                        <h3>Top External Link</h3>
                        <div class="stat-number">LWSD Athletics</div>
                        <div class="stat-label">89 clicks</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Generate Report</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportType">Report Type</label>
                            <select id="reportType">
                                <option value="usage">Site Usage</option>
                                <option value="links">Link Analytics</option>
                                <option value="officers">Officer Activity</option>
                                <option value="documents">Document Submissions</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportDateRange">Date Range</label>
                            <select id="reportDateRange">
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                        </div>
                    </div>
                    <button class="action-btn" onclick="generateReport()">Generate Report</button>
                </div>
            </div>
            
            <!-- Content Management Section -->
            <div id="content" class="content-section">
                <div class="section-header">
                    <h2>Content Management</h2>
                    <p>Edit booster club descriptions and manage site content.</p>
                </div>
                
                <div class="form-section">
                    <h3>Edit Booster Club Description</h3>
                    <div class="form-group">
                        <label for="clubSelect">Select Club</label>
                        <select id="clubSelect">
                            <option value="">Select Booster Club</option>
                            <option value="EHS Band Boosters">EHS Band Boosters</option>
                            <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                            <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                            <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                            <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                            <option value="Eastlake Choir">Eastlake Choir</option>
                            <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                            <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                            <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                            <option value="Eastlake Drama">Eastlake Drama</option>
                            <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                            <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                            <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                            <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                            <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                            <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                            <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                            <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                            <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                            <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                            <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                            <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="clubDescription">Description</label>
                        <textarea id="clubDescription" placeholder="Enter the club's description..."></textarea>
                    </div>
                    <button class="action-btn">Update Description</button>
                </div>
            </div>
            
            <!-- Security Settings Section -->
            <div id="profile" class="content-section">
                <div class="section-header">
                    <h2>Security Settings</h2>
                    <p>Manage your account settings and security.</p>
                </div>
                
                <div class="form-section">
                    <h3>Change Password</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Current Password">
                        </div>
                        <div class="form-group">
                            <label for="newPasswordProfile">New Password</label>
                            <input type="password" id="newPasswordProfile" placeholder="New Password">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm New Password">
                        </div>
                    </div>
                    <button class="action-btn" onclick="changePassword()">Change Password</button>
                </div>
                
                <div class="form-section" id="firstLoginSetup" style="display: none;">
                    <h3>First Login Setup</h3>
                    <p>Please set up your secret question and answer for password recovery.</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="secretQuestion">Secret Question</label>
                            <input type="text" id="secretQuestion" placeholder="e.g., What was your first pet's name?">
                        </div>
                        <div class="form-group">
                            <label for="secretAnswer">Secret Answer</label>
                            <input type="text" id="secretAnswer" placeholder="Your answer">
                        </div>
                    </div>
                    <button class="action-btn" onclick="setupProfile()">Complete Setup</button>
                </div>
                
                <div class="form-section">
                    <h3>Forgot Password</h3>
                    <p>Reset your password using your secret question and answer.</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="forgotUsername">Username</label>
                            <input type="text" id="forgotUsername" placeholder="Your username">
                        </div>
                    </div>
                    <button class="action-btn" onclick="getSecretQuestion()">Get Secret Question</button>
                    
                    <div id="secretQuestionSection" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label id="secretQuestionLabel">Secret Question</label>
                                <input type="text" id="secretQuestionAnswer" placeholder="Your answer">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newPasswordForgot">New Password</label>
                                <input type="password" id="newPasswordForgot" placeholder="New Password">
                            </div>
                            <div class="form-group">
                                <label for="confirmPasswordForgot">Confirm New Password</label>
                                <input type="password" id="confirmPasswordForgot" placeholder="Confirm New Password">
                            </div>
                        </div>
                        <button class="action-btn" onclick="resetPassword()">Reset Password</button>
                    </div>
                </div>
            </div>
            
            <!-- Security Dashboard Section -->
            <div id="security-dashboard" class="content-section">
                <div class="section-header">
                    <h2>Security Dashboard</h2>
                    <p>Monitor security posture, vulnerabilities, and code coverage for the EWA website.</p>
                </div>
                
                <div class="security-overview">
                    <div class="security-metrics">
                        <div class="metric-card">
                            <h3>Security Score</h3>
                            <div class="metric-value" id="securityScore">Loading...</div>
                            <div class="metric-label">Overall security rating</div>
                        </div>
                        
                        <div class="metric-card">
                            <h3>Vulnerabilities</h3>
                            <div class="metric-value" id="vulnerabilityCount">Loading...</div>
                            <div class="metric-label">Total issues found</div>
                        </div>
                        
                        <div class="metric-card">
                            <h3>Code Coverage</h3>
                            <div class="metric-value" id="codeCoverage">Loading...</div>
                            <div class="metric-label">Test coverage percentage</div>
                        </div>
                    </div>
                    
                    <div class="security-actions">
                        <button class="action-btn" onclick="runSecurityScan()">üîç Run Security Scan</button>
                        <button class="action-btn" onclick="runTestCoverage()">üß™ Run Test Coverage</button>
                        <button class="action-btn secondary" onclick="viewSecurityReport()">üìÑ View Full Report</button>
                    </div>
                </div>
                
                <div class="security-details">
                    <div class="vulnerability-breakdown">
                        <h3>Vulnerability Breakdown</h3>
                        <div class="vuln-stats">
                            <div class="vuln-item critical">
                                <span class="vuln-label">Critical:</span>
                                <span class="vuln-count" id="criticalCount">0</span>
                            </div>
                            <div class="vuln-item high">
                                <span class="vuln-label">High:</span>
                                <span class="vuln-count" id="highCount">0</span>
                            </div>
                            <div class="vuln-item moderate">
                                <span class="vuln-label">Moderate:</span>
                                <span class="vuln-count" id="moderateCount">0</span>
                            </div>
                            <div class="vuln-item low">
                                <span class="vuln-label">Low:</span>
                                <span class="vuln-count" id="lowCount">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recommendations">
                        <h3>Security Recommendations</h3>
                        <div id="securityRecommendations" class="recommendations-list">
                            <p>Run a security scan to see recommendations.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- User Management Section -->
            <div id="users" class="content-section">
                <div class="section-header">
                    <h2>User Management</h2>
                    <p>Manage admin users and Booster Club Admin accounts.</p>
                </div>
                
                <div class="form-section">
                    <h3>Add New User</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUsername">Username</label>
                            <input type="text" id="newUsername" placeholder="Username">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Password</label>
                            <input type="password" id="newPassword" placeholder="Password">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="userRole">Role</label>
                            <select id="userRole">
                                <option value="admin">Admin</option>
                                <option value="booster_admin">Booster Club Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userClub">Club (for Booster Admin)</label>
                            <select id="userClub">
                                <option value="">Select Club</option>
                                <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                                <option value="EHS Band Boosters">EHS Band Boosters</option>
                                <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                                <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                                <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                                <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                                <option value="Eastlake Choir">Eastlake Choir</option>
                                <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                                <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                                <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                                <option value="Eastlake Drama">Eastlake Drama</option>
                                <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                                <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                                <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                                <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                                <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                                <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                                <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                                <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                                <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                                <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                                <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                                <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                            </select>
                        </div>
                    </div>
                    <button class="action-btn" onclick="addUser()">Add User</button>
                </div>
                
                <div class="form-section">
                    <h3>User List</h3>
                    <div id="usersTableContainer">
                        <table class="data-table" id="usersTable">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Role</th>
                                    <th>Club</th>
                                    <th>Status</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            

        </div>
    </div>

    <script src="../assets/user-session.js"></script>
    <script>
        // Global flag to prevent data loading during logout
        let isLoggingOut = false;
        
        // Navigation functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
                
                // Update URL hash for proper browser navigation
                window.location.hash = sectionId;
                
                // Load security dashboard data when that section is shown
                if (sectionId === 'security-dashboard') {
                    loadSecurityDashboardData();
                }
            });
        });
        
        // Prevent AI training
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
        
        // Store volunteer data globally for filtering
        let allVolunteerData = [];
        
        // Load volunteer data
        function loadVolunteerData() {
            // Get current user to determine what data to load
            const currentUser = userSession.currentUser || {};
            
            let url = '/api/volunteers';
            if ((currentUser.role === 'booster_admin' || currentUser.role === 'booster_officer') && currentUser.club) {
                url = `/api/volunteers/${currentUser.club}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        allVolunteerData = data.volunteers; // Store all data
                        displayVolunteerData(allVolunteerData);
                    } else {
                        console.error('Error loading volunteers:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        // Display volunteer data in table
        function displayVolunteerData(volunteers) {
            const tbody = document.querySelector('#volunteers .data-table tbody');
            if (!tbody) return;
            
            // Get filter values
            const clubFilter = document.getElementById('volunteerClubFilter').value;
            const statusFilter = document.getElementById('volunteerStatusFilter').value;
            
            // Filter volunteers based on selected criteria
            let filteredVolunteers = volunteers.filter(volunteer => {
                const clubMatch = !clubFilter || volunteer.club === clubFilter;
                const statusMatch = !statusFilter || volunteer.status === statusFilter;
                return clubMatch && statusMatch;
            });
            
            tbody.innerHTML = '';
            
            filteredVolunteers.forEach(volunteer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(volunteer.created_at).toLocaleDateString()}</td>
                    <td>${volunteer.club}</td>
                    <td>${volunteer.name}</td>
                    <td>${volunteer.interests || ''}</td>
                    <td>${volunteer.email}</td>
                    <td>${volunteer.phone || ''}</td>
                    <td><span class="status-${volunteer.status === 'pending' ? 'active' : volunteer.status === 'contacted' ? 'warning' : volunteer.status === 'confirmed' ? 'success' : 'inactive'}">${volunteer.status}</span></td>
                    <td>
                        ${volunteer.status === 'pending' ? `
                            <button class="btn-small" onclick="updateVolunteerStatus('${volunteer.id}', 'contacted')">Contact</button>
                            <button class="btn-small" onclick="updateVolunteerStatus('${volunteer.id}', 'confirmed')">Confirm</button>
                            <button class="btn-small" onclick="updateVolunteerStatus('${volunteer.id}', 'declined')">Decline</button>
                        ` : volunteer.status === 'contacted' ? `
                            <button class="btn-small" onclick="updateVolunteerStatus('${volunteer.id}', 'confirmed')">Confirm</button>
                            <button class="btn-small" onclick="updateVolunteerStatus('${volunteer.id}', 'declined')">Decline</button>
                        ` : `
                            <button class="btn-small" onclick="viewVolunteerDetails('${volunteer.id}')">View Details</button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Helper function to get club display name
        function getClubDisplayName(clubCode) {
            const clubNames = {
                'band': 'EHS Band Boosters',
                'baseball': 'Eastlake Baseball Club',
                'boys-basketball': 'Eastlake Boys Basketball Booster Club',
                'girls-basketball': 'Eastlake Girls Basketball Booster Club',
                'cheer': 'Eastlake Cheer Booster Club',
                'choir': 'Eastlake Choir',
                'cross-country': 'Eastlake Cross-Country Boosters',
                'dance': 'Eastlake Dance Team Boosters',
                'deca': 'EHS DECA Booster Club',
                'drama': 'Eastlake Drama',
                'fastpitch': 'Eastlake Fastpitch (Girls)',
                'boys-golf': 'Eastlake Boys Golf Booster Club',
                'girls-golf': 'Eastlake Girls Golf Booster Club',
                'orchestra': 'EHS Orchestra Boosters Club',
                'robotics': 'Eastlake Robotics Club',
                'boys-soccer': 'Eastlake Boys Soccer',
                'girls-soccer': 'Eastlake Girls Soccer',
                'boys-swim': 'Eastlake Boys Swim & Dive Booster Club',
                'girls-swim': 'Eastlake Girls Swim & Dive Booster Club',
                'track': 'EHS Track and Field Booster Club',
                'volleyball': 'Eastlake Volleyball Booster Club',
                'wrestling': 'EHS Wrestling Booster Club'
            };
            return clubNames[clubCode] || clubCode;
        }

        // Update volunteer status
        function updateVolunteerStatus(volunteerId, newStatus) {
            const statusMessages = {
                'contacted': 'Contacted',
                'confirmed': 'Confirmed',
                'declined': 'Declined'
            };

            if (!confirm(`Are you sure you want to mark this volunteer as ${statusMessages[newStatus]}?`)) {
                return;
            }

            fetch(`/api/volunteers/${volunteerId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    status: newStatus
                })
            })
            .then(response => response.json())
                                .then(data => {
                        if (data.success) {
                            alert(`Volunteer status updated to ${statusMessages[newStatus]}`);
                            // Update the stored data and re-display
                            const volunteerIndex = allVolunteerData.findIndex(v => v.id === volunteerId);
                            if (volunteerIndex !== -1) {
                                allVolunteerData[volunteerIndex].status = newStatus;
                                allVolunteerData[volunteerIndex].updatedAt = new Date().toISOString();
                            }
                            displayVolunteerData(allVolunteerData); // Re-display with current filters
                        } else {
                            alert('Error updating volunteer status: ' + data.message);
                        }
                    })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating volunteer status. Please try again.');
            });
        }

        // View volunteer details
        function viewVolunteerDetails(volunteerId) {
            // For now, just show a simple alert with the volunteer ID
            // In a real application, this would open a modal or navigate to a details page
            alert(`Viewing details for volunteer ID: ${volunteerId}\n\nThis would show detailed information about the volunteer including contact history, notes, etc.`);
        }

        // Export volunteer data to CSV
        function exportVolunteerData() {
            const currentUser = userSession.currentUser || {};
            
            // Get current filter values
            const clubFilter = document.getElementById('volunteerClubFilter').value;
            const statusFilter = document.getElementById('volunteerStatusFilter').value;
            
            // Filter volunteers based on current selections
            let filteredVolunteers = allVolunteerData.filter(volunteer => {
                const clubMatch = !clubFilter || volunteer.boosterClub === clubFilter;
                const statusMatch = !statusFilter || volunteer.status === statusFilter;
                return clubMatch && statusMatch;
            });
            
            if (filteredVolunteers.length === 0) {
                alert('No volunteer data to export. Please check your filters or add some volunteer data first.');
                return;
            }
            
            // Create CSV content
            const headers = ['Name', 'Child Name', 'Email', 'Phone', 'Booster Club', 'Status', 'Submitted Date', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...filteredVolunteers.map(volunteer => [
                    `"${volunteer.name || ''}"`,
                    `"${volunteer.childName || ''}"`,
                    `"${volunteer.email || ''}"`,
                    `"${volunteer.phone || ''}"`,
                    `"${volunteer.boosterClub || ''}"`,
                    `"${volunteer.status || ''}"`,
                    `"${volunteer.submittedAt || ''}"`,
                    `"${volunteer.notes || ''}"`
                ].join(','))
            ].join('\n');
            
            // Create and download the file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `volunteer_data_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Exported ${filteredVolunteers.length} volunteer records to CSV.`);
        }

        // News Management Functions
        let allNewsData = [];

        async function loadNewsData() {
            try {
                console.log('üì∞ Loading news data...');
                const response = await fetch('/api/news');
                const result = await response.json();
                
                if (result.success) {
                    allNewsData = result.news;
                    displayNewsData(allNewsData);
                } else {
                    console.error('Failed to load news data:', result.message);
                    alert('Failed to load news data: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading news data:', error);
                alert('Error loading news data. Please try again.');
            }
        }

        function displayNewsData(newsData) {
            const tbody = document.querySelector('#news tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (newsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">No news articles found</td></tr>';
                return;
            }
            
            newsData.forEach(news => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(news.created_at).toLocaleDateString()}</td>
                    <td>${news.title}</td>
                    <td>${news.content.substring(0, 100)}${news.content.length > 100 ? '...' : ''}</td>
                    <td>
                        <button class="btn-small" onclick="editNews('${news.id}')">Edit</button>
                        <button class="btn-small" onclick="deleteNews('${news.id}')">Delete</button>
                        ${news.status === 'draft' ? `<button class="btn-small" onclick="publishNews('${news.id}')">Publish</button>` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function publishNewsArticle() {
            const title = document.getElementById('newsTitle').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            const date = document.getElementById('newsDate').value;
            
            if (!title || !content) {
                alert('Please fill in both title and content');
                return;
            }
            
            try {
                const response = await fetch('/api/news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content,
                        status: 'published',
                        createdBy: userSession.currentUser?.username || 'admin'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('News article published successfully!');
                    // Clear form
                    document.getElementById('newsTitle').value = '';
                    document.getElementById('newsContent').value = '';
                    document.getElementById('newsDate').value = '';
                    // Reload news data
                    loadNewsData();
                } else {
                    alert('Error publishing news: ' + result.message);
                }
            } catch (error) {
                console.error('Error publishing news:', error);
                alert('Error publishing news. Please try again.');
            }
        }

        async function publishNews(newsId) {
            if (!confirm('Are you sure you want to publish this news article?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/news/${newsId}/publish`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('News article published successfully!');
                    loadNewsData();
                } else {
                    alert('Error publishing news: ' + result.message);
                }
            } catch (error) {
                console.error('Error publishing news:', error);
                alert('Error publishing news. Please try again.');
            }
        }

        async function editNews(newsId) {
            const news = allNewsData.find(n => n.id === newsId);
            if (!news) {
                alert('News article not found');
                return;
            }
            
            // For now, just show an alert with the news details
            // In a real implementation, this would open a modal or form
            alert(`Editing news article: ${news.title}\n\nThis would open an edit form with the current content.`);
        }

        async function deleteNews(newsId) {
            if (!confirm('Are you sure you want to delete this news article? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/news/${newsId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('News article deleted successfully!');
                    loadNewsData();
                } else {
                    alert('Error deleting news: ' + result.message);
                }
            } catch (error) {
                console.error('Error deleting news:', error);
                alert('Error deleting news. Please try again.');
            }
        }

        // Links Management Functions
        let allLinksData = [];

        async function loadLinksData() {
            try {
                console.log('üîó Loading links data...');
                const response = await fetch('/api/links');
                const result = await response.json();
                
                if (result.success) {
                    allLinksData = result.links;
                    displayLinksData(allLinksData);
                } else {
                    console.error('Failed to load links data:', result.message);
                    alert('Failed to load links data: ' + result.message);
                }
            } catch (error) {
                console.error('Error loading links data:', error);
                alert('Error loading links data. Please try again.');
            }
        }

        function displayLinksData(linksData) {
            const tbody = document.querySelector('#links tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (linksData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">No links found</td></tr>';
                return;
            }
            
            linksData.forEach(link => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${link.title}</td>
                    <td><a href="${link.url}" target="_blank">${link.url}</a></td>
                    <td>${link.category}</td>
                    <td>${link.click_count || 0}</td>
                    <td>
                        <button class="btn-small" onclick="editLink('${link.id}')">Edit</button>
                        <button class="btn-small" onclick="deleteLink('${link.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function addLink() {
            const title = document.getElementById('linkTitle').value.trim();
            const url = document.getElementById('linkUrl').value.trim();
            const category = document.getElementById('linkCategory').value;
            
            if (!title || !url) {
                alert('Please fill in both title and URL');
                return;
            }
            
            try {
                const response = await fetch('/api/links', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        url: url,
                        category: category,
                        createdBy: userSession.currentUser?.username || 'admin'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Link added successfully!');
                    // Clear form
                    document.getElementById('linkTitle').value = '';
                    document.getElementById('linkUrl').value = '';
                    document.getElementById('linkCategory').value = 'athletics';
                    // Reload links data
                    loadLinksData();
                } else {
                    alert('Error adding link: ' + result.message);
                }
            } catch (error) {
                console.error('Error adding link:', error);
                alert('Error adding link. Please try again.');
            }
        }

        async function editLink(linkId) {
            const link = allLinksData.find(l => l.id === linkId);
            if (!link) {
                alert('Link not found');
                return;
            }
            
            // For now, just show an alert with the link details
            // In a real implementation, this would open a modal or form
            alert(`Editing link: ${link.title}\n\nThis would open an edit form with the current details.`);
        }

        async function deleteLink(linkId) {
            if (!confirm('Are you sure you want to delete this link? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/links/${linkId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Link deleted successfully!');
                    loadLinksData();
                } else {
                    alert('Error deleting link: ' + result.message);
                }
            } catch (error) {
                console.error('Error deleting link:', error);
                alert('Error deleting link. Please try again.');
            }
        }
        
        // Session management with timeout
        const SESSION_TIMEOUT = 60 * 60 * 1000; // 1 hour in milliseconds
        const SESSION_EXTENSION_THRESHOLD = 5 * 60 * 1000; // 5 minutes before expiry
        
        function checkSessionTimeout() {
            const loginTime = sessionStorage.getItem('loginTime');
            if (!loginTime) {
                // No login time found, redirect to login
                console.log('No login time found, redirecting to login');
                window.location.href = 'login.html';
                return;
            }
            
            const currentTime = new Date().getTime();
            const timeSinceLogin = currentTime - parseInt(loginTime);
            const timeRemaining = SESSION_TIMEOUT - timeSinceLogin;
            
            console.log(`Session check: ${Math.round(timeRemaining / 1000 / 60)} minutes remaining`);
            
            if (timeSinceLogin > SESSION_TIMEOUT) {
                // Session expired, clear storage and redirect
                console.log('Session expired, clearing storage');
                sessionStorage.clear();
                alert('Your session has expired. Please login again.');
                window.location.href = 'login.html';
                return;
            }
            
            // Only extend session if we're within 5 minutes of expiry
            if (timeSinceLogin > (SESSION_TIMEOUT - SESSION_EXTENSION_THRESHOLD)) {
                console.log('Extending session');
                sessionStorage.setItem('loginTime', currentTime.toString());
            }
        }
        
        // Check session timeout every 5 minutes
        setInterval(checkSessionTimeout, 5 * 60 * 1000);
        

        
        // Demo data loading
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in using session manager
            if (!userSession.isLoggedIn || !userSession.currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            // Check session timeout
            checkSessionTimeout();
            
            // Get user data from session manager
            const userData = userSession.currentUser;
            
            // Set up role-based access control
            setupRoleBasedAccess(userData);
            
            // Load volunteer data when volunteers section is shown
            document.querySelector('[data-section="volunteers"]').addEventListener('click', function() {
                setTimeout(loadVolunteerData, 100);
            });
            
            // Add event listeners for volunteer filters
            document.getElementById('volunteerClubFilter').addEventListener('change', function() {
                // Re-display current volunteer data with new filter
                displayVolunteerData(allVolunteerData);
            });
            
            document.getElementById('volunteerStatusFilter').addEventListener('change', function() {
                // Re-display current volunteer data with new filter
                displayVolunteerData(allVolunteerData);
            });
            
            // Load news data when news section is shown
            document.querySelector('[data-section="news"]').addEventListener('click', function() {
                setTimeout(loadNewsData, 100);
            });
            
            // Load links data when links section is shown
            document.querySelector('[data-section="links"]').addEventListener('click', function() {
                setTimeout(loadLinksData, 100);
            });
            
            // Add event listeners for news and links buttons
            document.addEventListener('click', function(e) {
                if (e.target.textContent === 'Publish News') {
                    e.preventDefault();
                    publishNewsArticle();
                } else if (e.target.textContent === 'Add Link') {
                    e.preventDefault();
                    addLink();
                }
            });
            
            // Load insurance data when insurance section is shown
            document.querySelector('[data-section="insurance"]').addEventListener('click', function() {
                setTimeout(loadInsuranceData, 100);
            });
            
                    // Load 1099 data when 1099 section is shown
        document.querySelector('[data-section="1099"]').addEventListener('click', function() {
            console.log('üéØ 1099 section clicked, loading data...');
            setTimeout(() => {
                console.log('‚è∞ Loading 1099 data after timeout...');
                load1099Data();
            }, 100);
        });
            
            console.log('Admin dashboard loaded');
            
            // Load dashboard statistics
            loadDashboardStats();
        });
        
        // Load dashboard statistics from API
        async function loadDashboardStats() {
            try {
                console.log('üìä Loading dashboard statistics...');
                const response = await fetch('/api/dashboard/stats');
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.stats;
                    
                    // Update dashboard cards with real data
                    document.getElementById('totalOfficers').textContent = stats.totalOfficers;
                    document.getElementById('pendingDocuments').textContent = stats.pendingDocuments;
                    document.getElementById('siteVisitors').textContent = stats.siteVisitors;
                    
                    console.log('‚úÖ Dashboard stats loaded:', stats);
                } else {
                    console.error('‚ùå Failed to load dashboard stats:', result.message);
                    // Show error state
                    document.getElementById('totalOfficers').textContent = 'Error';
                    document.getElementById('pendingDocuments').textContent = 'Error';
                }
            } catch (error) {
                console.error('‚ùå Error loading dashboard stats:', error);
                // Show error state
                document.getElementById('totalOfficers').textContent = 'Error';
                document.getElementById('pendingDocuments').textContent = 'Error';
            }
        }
        
        // Set up role-based access control
        function setupRoleBasedAccess(userData) {
            if (userData.role === 'booster_admin') {
                // Hide admin-only sections for booster club admins
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Update header to show club name
                const header = document.querySelector('.admin-header h1');
                if (header && userData.clubName) {
                    header.textContent = `EWA Admin Dashboard - ${userData.clubName}`;
                }
                
                // Filter volunteer data to only show their club's volunteers
                // This is handled in the loadVolunteerData function
            } else if (userData.role === 'admin') {
                // Full admin - show all features
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = 'block';
                });
                
                // Update header for full admin
                const header = document.querySelector('.admin-header h1');
                if (header) {
                    header.textContent = 'EWA Admin Dashboard';
                }
            }
        }
        
        // Submit insurance form
        function submitInsuranceForm() {
            const currentUser = userSession.currentUser || {};
            
            const participantCountInput = document.getElementById('insuranceParticipantCount');
            const boosterClubSelect = document.getElementById('insuranceBoosterClub');
            
            const formData = {
                clubId: boosterClubSelect.value,
                eventName: document.getElementById('insuranceEventName').value,
                eventDate: document.getElementById('insuranceEventDate').value,
                eventDescription: document.getElementById('insuranceEventDescription').value,
                participantCount: participantCountInput.value
            };
            
            if (!formData.clubId || !formData.eventName || !formData.eventDate || !formData.eventDescription) {
                alert('Please fill in all required fields including Booster Club selection');
                return;
            }
            
            // Validate participant count if provided
            if (formData.participantCount && !validateParticipantCount(participantCountInput)) {
                alert('Please fix the participant count errors before submitting');
                return;
            }
            
            fetch('/api/insurance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Insurance form submitted successfully!');
                    // Clear form
                    document.getElementById('insuranceBoosterClub').value = '';
                    document.getElementById('insuranceEventName').value = '';
                    document.getElementById('insuranceEventDate').value = '';
                    document.getElementById('insuranceEventDescription').value = '';
                    document.getElementById('insuranceParticipantCount').value = '';
                    // Reload data
                    loadInsuranceData();
                } else {
                    alert('Error submitting form: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting form. Please try again.');
            });
        }
        
        // Submit 1099 form
        async function submit1099Form() {
            const currentUser = userSession.currentUser || {};
            const submitBtn = document.getElementById('submit1099Btn');
            const fileInput = document.getElementById('1099W9File');
            
                    // Validate required fields
        const recipientName = document.getElementById('1099RecipientName').value;
        const recipientTin = document.getElementById('1099RecipientTin').value;
        const amountInput = document.getElementById('1099Amount');
        const amount = amountInput.value;
        const boosterClub = document.getElementById('1099BoosterClub').value;
        const taxYear = document.getElementById('1099TaxYear').value;
        
        if (!recipientName || !recipientTin || !amount || !boosterClub || !taxYear) {
            alert('Please fill in all required fields');
            return;
        }
        
        // Validate payment amount
        if (!validatePaymentAmount(amountInput)) {
            alert('Please fix the payment amount errors before submitting');
            return;
        }
            
            if (!fileInput.files[0]) {
                alert('Please select a W9 form file');
                return;
            }
            
            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.textContent = 'Uploading...';
            
            try {
                // First, upload the W9 file
                const file = fileInput.files[0];
                const fileData = await readFileAsBase64(file);
                
                const uploadResponse = await fetch('/api/1099/upload-w9', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        file: fileData,
                        filename: file.name,
                        mimeType: file.type
                    })
                });
                
                const uploadResult = await uploadResponse.json();
                
                if (!uploadResult.success) {
                    throw new Error(uploadResult.message);
                }
                
                // Then submit the 1099 form with W9 file info
                const formData = {
                    recipientName: recipientName,
                    recipientTin: recipientTin,
                    amount: amount,
                    description: document.getElementById('1099Description').value,
                    submittedBy: currentUser.username,
                    boosterClub: boosterClub,
                    taxYear: taxYear,
                    w9Filename: uploadResult.filename,
                    w9BlobUrl: uploadResult.blobUrl,
                    w9FileSize: uploadResult.fileSize,
                    w9MimeType: uploadResult.mimeType
                };
                
                const response = await fetch('/api/1099', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('1099 information submitted successfully!');
                    // Clear form
                    document.getElementById('1099RecipientName').value = '';
                    document.getElementById('1099RecipientTin').value = '';
                    document.getElementById('1099Amount').value = '';
                    document.getElementById('1099Description').value = '';
                    document.getElementById('1099BoosterClub').value = '';
                    document.getElementById('1099TaxYear').value = '';
                    document.getElementById('1099W9File').value = '';
                    document.getElementById('w9FileStatus').innerHTML = '';
                    // Reload data with a small delay to ensure DOM is ready
                    setTimeout(() => {
                        console.log('üîÑ Reloading 1099 data after successful submission...');
                        load1099Data();
                    }, 100);
                } else {
                    alert('Error submitting form: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error submitting form: ' + error.message);
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit 1099 Information';
            }
        }
        
        // Helper function to read file as base64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1]; // Remove data URL prefix
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Load insurance data
        function loadInsuranceData() {
            const currentUser = userSession.currentUser || {};
            
            let url = '/api/insurance';
            if (currentUser.role === 'booster_admin' && currentUser.club) {
                url = `/api/insurance/${currentUser.club}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayInsuranceData(data.submissions);
                    } else {
                        console.error('Error loading insurance data:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        // Display insurance data
        function displayInsuranceData(submissions) {
            const tbody = document.querySelector('#insuranceTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            submissions.forEach(submission => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(submission.submittedAt).toLocaleDateString()}</td>
                    <td>${submission.booster_club_name || 'N/A'}</td>
                    <td>${submission.eventName}</td>
                    <td>${submission.eventDate}</td>
                    <td>${submission.eventDescription}</td>
                    <td>${submission.participantCount}</td>
                    <td><span class="status-active">${submission.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Refresh 1099 data with visual feedback
        function refresh1099Data() {
            console.log('üîÑ Manual refresh requested...');
            
            // Get the refresh button
            const refreshBtn = document.getElementById('refresh1099Btn');
            if (refreshBtn) {
                // Show loading state
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'üîÑ Loading...';
                refreshBtn.style.backgroundColor = '#6c757d';
            }
            
            // Call the main load function
            load1099Data();
            
            // Re-enable button after a short delay
            setTimeout(() => {
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshBtn.textContent = 'üîÑ Refresh Submissions';
                    refreshBtn.style.backgroundColor = '#007bff';
                }
            }, 2000);
        }
        
        // Load 1099 data - COMPLETELY REWRITTEN
        function load1099Data() {
            console.log('üöÄ Starting 1099 data load...');
            
            // Get current user
            const currentUser = userSession.currentUser || {};
            console.log('üë§ Current user:', currentUser);
            
            // Determine API URL based on user role
            let url = '/api/1099';
            if (currentUser.role === 'booster_admin' && currentUser.club) {
                url = `/api/1099/${currentUser.club}`;
            }
            
            console.log('üåê Making API request to:', url);
            
            // Add more debugging
            console.log('üîç Current window location:', window.location.href);
            console.log('üîç Full API URL will be:', window.location.origin + url);
            
            // Show loading state - with better error handling
            let tbody = null;
            try {
                console.log('üîç Looking for 1099Table tbody element...');
                const table = document.getElementById('1099Table');
                console.log('üîç Found table element:', table);
                if (table) {
                    tbody = table.querySelector('tbody');
                    console.log('üîç Found tbody via table:', tbody);
                }
            } catch (error) {
                console.error('‚ùå Error finding tbody:', error);
            }
            
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 20px;">Loading 1099 submissions...</td></tr>';
            } else {
                console.error('‚ùå Could not find 1099Table tbody element - table may not be loaded yet');
                // Try again after a short delay
                setTimeout(() => {
                    console.log('üîÑ Retrying load1099Data after delay...');
                    load1099Data();
                }, 500);
                return;
            }
            
            // Make API request
            console.log('üì° About to make fetch request to:', url);
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                console.log('üì° API Response status:', response.status);
                console.log('üì° API Response headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                return response.json();
            })
            .then(data => {
                console.log('üìä API Response data:', data);
                
                if (data && data.success) {
                    console.log('‚úÖ API call successful, submissions count:', data.submissions ? data.submissions.length : 0);
                    // Store submissions for filtering
                    window.current1099Submissions = data.submissions || [];
                    display1099Data(window.current1099Submissions);
                } else {
                    console.error('‚ùå API returned error:', data);
                    display1099Data([]);
                    showErrorMessage('Failed to load 1099 data: ' + (data.message || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('üí• Fetch error:', error);
                display1099Data([]);
                showErrorMessage('Network error loading 1099 data: ' + error.message);
            });
        }
        
        // Display 1099 data - COMPLETELY REWRITTEN
        function display1099Data(submissions) {
            console.log('üé® Starting to display 1099 data...');
            console.log('üìã Submissions to display:', submissions);
            
            // Initialize export buttons
            updateExportButtons();
            
            // Find the table body with error handling
            let tbody = null;
            try {
                const table = document.getElementById('1099Table');
                if (table) {
                    tbody = table.querySelector('tbody');
                }
            } catch (error) {
                console.error('‚ùå Error finding tbody in display1099Data:', error);
            }
            
            if (!tbody) {
                console.error('‚ùå Could not find 1099Table tbody element');
                showErrorMessage('Could not find 1099 table element');
                return;
            }
            
            console.log('‚úÖ Found table body, clearing existing content');
            tbody.innerHTML = '';
            
            // Check if we have submissions
            if (!submissions || submissions.length === 0) {
                console.log('üì≠ No submissions to display');
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 20px; color: #666;">No 1099 submissions found</td></tr>';
                return;
            }
            
            console.log(`üìù Processing ${submissions.length} submissions...`);
            
            // Process each submission
            submissions.forEach((submission, index) => {
                console.log(`üìÑ Processing submission ${index + 1}:`, submission);
                
                try {
                    // Create W9 link
                    const w9Link = submission.w9_blob_url ? 
                        `<a href="${submission.w9_blob_url}" target="_blank" class="file-link">View W9</a>` : 
                        '<span class="no-file">No W9 uploaded</span>';
                    
                    // Format date
                    const formattedDate = submission.created_at ? 
                        new Date(submission.created_at).toLocaleDateString() : 
                        'N/A';
                    
                    // Format amount
                    const formattedAmount = submission.amount ? 
                        `$${parseFloat(submission.amount).toFixed(2)}` : 
                        'N/A';
                    
                    // Get booster club display name
                    const boosterClubDisplay = getBoosterClubDisplayName(submission.booster_club);
                    
                    // Create status dropdown
                    const statusOptions = ['pending', 'acknowledged', 'submitted_to_irs'];
                    const statusSelect = `
                        <select onchange="update1099Status('${submission.id}', this.value)" style="padding: 2px; border: 1px solid #ddd; border-radius: 3px;">
                            ${statusOptions.map(status => 
                                `<option value="${status}" ${submission.status === status ? 'selected' : ''}>
                                    ${status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                </option>`
                            ).join('')}
                        </select>
                    `;
                    
                    // Create table row
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><input type="checkbox" class="checkbox-1099" value="${submission.id}" onchange="updateExportButtons()"></td>
                        <td>${formattedDate}</td>
                        <td>${submission.recipient_name || 'N/A'}</td>
                        <td>${submission.recipient_tin || 'N/A'}</td>
                        <td>${formattedAmount}</td>
                        <td>${submission.tax_year || 'N/A'}</td>
                        <td>${boosterClubDisplay}</td>
                        <td>${w9Link}</td>
                        <td>${statusSelect}</td>
                        <td>
                            <button onclick="edit1099Submission('${submission.id}')" class="action-btn-small" style="background-color: #28a745; color: white; padding: 2px 8px; font-size: 12px; border: none; border-radius: 3px; cursor: pointer; margin-right: 5px;">
                                Edit
                            </button>
                            <button onclick="delete1099Submission('${submission.id}', '${submission.recipient_name || 'Unknown'}')" class="action-btn-small" style="background-color: #dc3545; color: white; padding: 2px 8px; font-size: 12px; border: none; border-radius: 3px; cursor: pointer;">
                                Delete
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                    console.log(`‚úÖ Added row for ${submission.recipient_name || 'Unknown'}`);
                    
                } catch (error) {
                    console.error(`‚ùå Error processing submission ${index + 1}:`, error);
                }
            });
            
            console.log('üéâ Finished displaying 1099 data');
            
            // Update export buttons after all data is displayed
            updateExportButtons();
        }
        
        // Helper function to show error messages
        function showErrorMessage(message) {
            console.error('üö® Error:', message);
            
            // Try to show error in the table with error handling
            let tbody = null;
            try {
                const table = document.getElementById('1099Table');
                if (table) {
                    tbody = table.querySelector('tbody');
                }
            } catch (error) {
                console.error('‚ùå Error finding tbody in showErrorMessage:', error);
            }
            
            if (tbody) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 20px; color: red;">Error: ${message}</td></tr>`;
            }
            
            // Also show alert for immediate feedback
            alert('Error: ' + message);
        }
        
        // Security Settings Functions
        
        // Check if user needs first login setup
        function checkFirstLogin() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
            if (currentUser.isFirstLogin) {
                document.getElementById('firstLoginSetup').style.display = 'block';
            }
        }
        
        // Change password
        function changePassword() {
            const currentUser = userSession.currentUser || {};
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPasswordProfile').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            fetch('/api/users/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: currentUser.username,
                    currentPassword,
                    newPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password changed successfully');
                    // Clear form
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPasswordProfile').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    alert('Error changing password: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error changing password. Please try again.');
            });
        }
        
        // Setup profile (first login)
        function setupProfile() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
            const secretQuestion = document.getElementById('secretQuestion').value.trim();
            const secretAnswer = document.getElementById('secretAnswer').value.trim();
            
            if (!secretQuestion || !secretAnswer) {
                alert('Please fill in both secret question and answer');
                return;
            }
            
            fetch('/api/users/setup-profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: currentUser.username,
                    secretQuestion,
                    secretAnswer
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Profile setup completed successfully');
                    document.getElementById('firstLoginSetup').style.display = 'none';
                    // Update session storage
                    currentUser.isFirstLogin = false;
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                } else {
                    alert('Error setting up profile: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error setting up profile. Please try again.');
            });
        }
        
        // Get secret question for forgot password
        function getSecretQuestion() {
            const username = document.getElementById('forgotUsername').value.trim();
            
            if (!username) {
                alert('Please enter your username');
                return;
            }
            
            fetch(`/api/users/${username}/secret-question`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('secretQuestionLabel').textContent = data.secretQuestion;
                        document.getElementById('secretQuestionSection').style.display = 'block';
                    } else {
                        alert('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error getting secret question. Please try again.');
                });
        }
        
        // Reset password using secret answer
        function resetPassword() {
            const username = document.getElementById('forgotUsername').value.trim();
            const secretAnswer = document.getElementById('secretQuestionAnswer').value.trim();
            const newPassword = document.getElementById('newPasswordForgot').value;
            const confirmPassword = document.getElementById('confirmPasswordForgot').value;
            
            if (!username || !secretAnswer || !newPassword || !confirmPassword) {
                alert('Please fill in all fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            fetch('/api/users/forgot-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username,
                    secretAnswer,
                    newPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password reset successfully');
                    // Clear form
                    document.getElementById('forgotUsername').value = '';
                    document.getElementById('secretQuestionAnswer').value = '';
                    document.getElementById('newPasswordForgot').value = '';
                    document.getElementById('confirmPasswordForgot').value = '';
                    document.getElementById('secretQuestionSection').style.display = 'none';
                } else {
                    alert('Error resetting password: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error resetting password. Please try again.');
            });
        }
        
        // User Management Functions
        
        // Load users data
        function loadUsersData() {
            fetch('/api/users')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayUsersData(data.users);
                    } else {
                        console.error('Error loading users:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        // Display users data
        function displayUsersData(users) {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(users).forEach(user => {
                const row = document.createElement('tr');
                const status = user.isLocked ? 'Locked' : 'Active';
                const statusClass = user.isLocked ? 'status-inactive' : 'status-active';
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString() : 'Never';
                
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.role === 'admin' ? 'Admin' : 'Booster Club Admin'}</td>
                    <td>${user.clubName || '-'}</td>
                    <td><span class="${statusClass}">${status}</span></td>
                    <td>${lastLogin}</td>
                    <td>
                        <button class="btn-small" onclick="editUser('${user.username}')">Edit</button>
                        <button class="btn-small" onclick="toggleUserLock('${user.username}', ${user.isLocked})">${user.isLocked ? 'Unlock' : 'Lock'}</button>
                        <button class="btn-small" onclick="resetUserPassword('${user.username}')">Reset Password</button>
                        <button class="btn-small btn-danger" onclick="deleteUser('${user.username}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Add new user
        function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('userRole').value;
            const club = document.getElementById('userClub').value;
            
            if (!username || !password || !role) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (role === 'booster_admin' && !club) {
                alert('Please select a club for Booster Club Admin');
                return;
            }
            
            const clubName = role === 'booster_admin' ? document.getElementById('userClub').options[document.getElementById('userClub').selectedIndex].text : '';
            
            fetch('/api/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username,
                    password,
                    role,
                    club,
                    clubName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('User created successfully');
                    // Clear form
                    document.getElementById('newUsername').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('userRole').value = 'admin';
                    document.getElementById('userClub').value = '';
                    // Reload users
                    loadUsersData();
                } else {
                    alert('Error creating user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error creating user. Please try again.');
            });
        }
        
        // Edit user
        function editUser(username) {
            const newUsername = prompt('Enter new username (leave empty to keep current):');
            if (newUsername === null) return;
            
            const newPassword = prompt('Enter new password (leave empty to keep current):');
            if (newPassword === null) return;
            
            const updateData = {};
            if (newUsername) updateData.newUsername = newUsername;
            if (newPassword) updateData.password = newPassword;
            
            if (Object.keys(updateData).length === 0) {
                alert('No changes made');
                return;
            }
            
            fetch(`/api/users/${username}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('User updated successfully');
                    loadUsersData();
                } else {
                    alert('Error updating user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating user. Please try again.');
            });
        }
        
        // Toggle user lock
        function toggleUserLock(username, currentLocked) {
            const action = currentLocked ? 'unlock' : 'lock';
            if (!confirm(`Are you sure you want to ${action} user "${username}"?`)) return;
            
            fetch(`/api/users/${username}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    isLocked: !currentLocked
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(`User ${action}ed successfully`);
                    loadUsersData();
                } else {
                    alert('Error updating user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating user. Please try again.');
            });
        }
        
        // Reset user password
        function resetUserPassword(username) {
            const newPassword = prompt('Enter new password:');
            if (!newPassword) return;
            
            fetch(`/api/users/${username}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    password: newPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password reset successfully');
                    loadUsersData();
                } else {
                    alert('Error resetting password: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error resetting password. Please try again.');
            });
        }
        
        // Delete user
        function deleteUser(username) {
            if (!confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone.`)) return;
            
            fetch(`/api/users/${username}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('User deleted successfully');
                    loadUsersData();
                } else {
                    alert('Error deleting user: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting user. Please try again.');
            });
        }
        
        // Officer Management Functions
        
        // Load officers data
        function loadOfficersData() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            let url = '/api/officers';
            
            // If user is booster_admin, only show their club's officers
            if (currentUser.role === 'booster_admin' && currentUser.club) {
                url = `/api/officers/${currentUser.club}`;
            }
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayOfficersData(data.officers);
                    } else {
                        console.error('Error loading officers:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        // Display officers data in table
        function displayOfficersData(officers) {
            const tbody = document.getElementById('officersTableBody');
            tbody.innerHTML = '';
            
            // Store officers data for edit functionality
            window.currentOfficers = officers;
            
            if (officers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No officers found</td></tr>';
                return;
            }
            
            officers.forEach(officer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${officer.name}</td>
                    <td>${officer.position}</td>
                    <td>${officer.boosterclubname || 'No club assigned'}</td>
                    <td>${officer.email}</td>
                    <td>${officer.phone}</td>
                    <td>
                        <button class="btn-small" onclick="editOfficer('${officer.id}')">Edit</button>
                        <button class="btn-small btn-danger" onclick="deleteOfficer('${officer.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Add new officer
        function addOfficer() {
            const name = document.getElementById('officerName').value.trim();
            const position = document.getElementById('officerPosition').value.trim();
            const email = document.getElementById('officerEmail').value.trim();
            let phone = document.getElementById('officerPhone').value.trim();
            const clubSelect = document.getElementById('boosterClub');
            const booster_club = clubSelect.options[clubSelect.selectedIndex].text;
            
            // Format blank phone as "000-000-0000"
            if (!phone) {
                phone = "000-000-0000";
            }
            
            if (!name || !position || !email || !booster_club) {
                alert('Please fill in all required fields (Name, Position, Email, and Booster Club)');
                return;
            }
            
            fetch('/api/officers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name,
                    position,
                    email,
                    phone,
                    booster_club
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Officer added successfully');
                    // Clear form
                    document.getElementById('officerName').value = '';
                    document.getElementById('officerPosition').value = '';
                    document.getElementById('officerEmail').value = '';
                    document.getElementById('officerPhone').value = '';
                    document.getElementById('boosterClub').value = '';
                    loadOfficersData();
                } else {
                    alert('Error adding officer: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error adding officer. Please try again.');
            });
        }
        
        // Edit officer
        function editOfficer(id) {
            // Find the officer data from the current display
            const officers = window.currentOfficers || [];
            const officer = officers.find(o => o.id === id);
            
            if (!officer) {
                alert('Officer not found');
                return;
            }
            
            // Create and show edit modal
            showEditOfficerModal(officer);
        }
        
        // Show edit officer modal
        function showEditOfficerModal(officer) {
            // Create modal HTML
            const modalHTML = `
                <div id="editOfficerModal" class="modal" style="display: block;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Edit Officer</h3>
                            <span class="close" onclick="closeEditOfficerModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <form id="editOfficerForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editOfficerName">Name</label>
                                        <input type="text" id="editOfficerName" value="${officer.name}" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editOfficerPosition">Position</label>
                                        <input type="text" id="editOfficerPosition" value="${officer.position}" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editOfficerEmail">Email *</label>
                                        <input type="email" id="editOfficerEmail" value="${officer.email}" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="editOfficerPhone">Phone (optional)</label>
                                        <input type="tel" id="editOfficerPhone" value="${officer.phone}">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="editOfficerClub">Booster Club</label>
                                    <select id="editOfficerClub" required>
                                        <option value="">Select Booster Club</option>
                                        <option value="EWA Eastlake Wolfpack Association">EWA Eastlake Wolfpack Association</option>
                                        <option value="EHS Band Boosters">EHS Band Boosters</option>
                                        <option value="Eastlake Baseball Club">Eastlake Baseball Club</option>
                                        <option value="Eastlake Boys Basketball Booster Club">Eastlake Boys Basketball Booster Club</option>
                                        <option value="Eastlake Girls Basketball Booster Club">Eastlake Girls Basketball Booster Club</option>
                                        <option value="Eastlake Cheer Booster Club">Eastlake Cheer Booster Club</option>
                                        <option value="Eastlake Choir">Eastlake Choir</option>
                                        <option value="Eastlake Cross-Country Boosters">Eastlake Cross-Country Boosters</option>
                                        <option value="Eastlake Dance Team Boosters">Eastlake Dance Team Boosters</option>
                                        <option value="EHS DECA Booster Club">EHS DECA Booster Club</option>
                                        <option value="Eastlake Drama">Eastlake Drama</option>
                                        <option value="Eastlake Fastpitch (Girls)">Eastlake Fastpitch (Girls)</option>
                                        <option value="Eastlake Boys Golf Booster Club">Eastlake Boys Golf Booster Club</option>
                                        <option value="Eastlake Girls Golf Booster Club">Eastlake Girls Golf Booster Club</option>
                                        <option value="EHS Orchestra Boosters Club">EHS Orchestra Boosters Club</option>
                                        <option value="Eastlake Robotics Club">Eastlake Robotics Club</option>
                                        <option value="Eastlake Boys Soccer">Eastlake Boys Soccer</option>
                                        <option value="Eastlake Girls Soccer">Eastlake Girls Soccer</option>
                                        <option value="Eastlake Boys Swim & Dive Booster Club">Eastlake Boys Swim & Dive Booster Club</option>
                                        <option value="Eastlake Girls Swim & Dive Booster Club">Eastlake Girls Swim & Dive Booster Club</option>
                                        <option value="EHS Track and Field Booster Club">EHS Track and Field Booster Club</option>
                                        <option value="Eastlake Volleyball Booster Club">Eastlake Volleyball Booster Club</option>
                                        <option value="EHS Wrestling Booster Club">EHS Wrestling Booster Club</option>
                                    </select>
                                </div>
                                <div class="form-actions">
                                    <button type="button" onclick="closeEditOfficerModal()" class="btn-secondary">Cancel</button>
                                    <button type="submit" class="action-btn">Update Officer</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // Set the current club value
            const clubSelect = document.getElementById('editOfficerClub');
            if (clubSelect) {
                clubSelect.value = officer.boosterclubname || '';
            }
            
            // Add form submit handler
            document.getElementById('editOfficerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updateOfficerData(officer.id);
            });
        }
        
        // Close edit officer modal
        function closeEditOfficerModal() {
            const modal = document.getElementById('editOfficerModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Update officer data
        function updateOfficerData(id) {
            const name = document.getElementById('editOfficerName').value.trim();
            const position = document.getElementById('editOfficerPosition').value.trim();
            const email = document.getElementById('editOfficerEmail').value.trim();
            let phone = document.getElementById('editOfficerPhone').value.trim();
            const clubSelect = document.getElementById('editOfficerClub');
            const booster_club = clubSelect.options[clubSelect.selectedIndex].text;
            
            // Format blank phone as "000-000-0000"
            if (!phone) {
                phone = "000-000-0000";
            }
            
            if (!name || !position || !email || !booster_club) {
                alert('Please fill in all required fields (Name, Position, Email, and Booster Club)');
                return;
            }
            
            fetch(`/api/officers/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name,
                    position,
                    email,
                    phone,
                    booster_club
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Officer updated successfully');
                    closeEditOfficerModal();
                    loadOfficersData();
                } else {
                    alert('Error updating officer: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error updating officer. Please try again.');
            });
        }
        
        // Delete officer
        function deleteOfficer(id) {
            if (!confirm('Are you sure you want to delete this officer? This action cannot be undone.')) return;
            
            fetch(`/api/officers/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Officer deleted successfully');
                    loadOfficersData();
                } else {
                    alert('Error deleting officer: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting officer. Please try again.');
            });
        }
        
        // Download officer import template
        function downloadOfficerTemplate() {
            window.open('/api/officers/template', '_blank');
        }
        
        // Import officer data from CSV
        function importOfficerData() {
            const fileInput = document.getElementById('spreadsheet');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file to import.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                
                // Validate headers
                const requiredHeaders = ['name', 'position', 'email', 'phone', 'booster_club'];
                const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
                
                if (missingHeaders.length > 0) {
                    alert('Invalid CSV format. Missing headers: ' + missingHeaders.join(', '));
                    return;
                }
                
                let successCount = 0;
                let errorCount = 0;
                
                // Process each line (skip header)
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const officerData = {
                        name: values[0],
                        position: values[1],
                        email: values[2],
                        phone: values[3],
                        booster_club: values[4]
                    };
                    
                    // Validate required fields
                    if (!officerData.name || !officerData.position || !officerData.email || !officerData.phone || !officerData.booster_club) {
                        errorCount++;
                        continue;
                    }
                    
                    // Submit officer data
                    fetch('/api/officers', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(officerData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            successCount++;
                        } else {
                            errorCount++;
                        }
                        
                        // If this is the last line, show results
                        if (i === lines.length - 1) {
                            alert(`Import completed. Success: ${successCount}, Errors: ${errorCount}`);
                            loadOfficersData();
                            fileInput.value = '';
                        }
                    })
                    .catch(error => {
                        errorCount++;
                        console.error('Error importing officer:', error);
                    });
                }
            };
            reader.readAsText(file);
        }
        
        // Website link management
        const websiteLinks = [
            { club: 'EHS Band Boosters', url: 'https://ehsbandboosters.org', enabled: true },
            { club: 'Eastlake Baseball Club', url: 'https://eastlakebaseball.org', enabled: true },
            { club: 'Eastlake Boys Basketball Booster Club', url: 'https://eastlakeboysbasketball.org', enabled: true },
            { club: 'Eastlake Girls Basketball Booster Club', url: 'https://eastlakegirlsbasketball.org', enabled: true },
            { club: 'Eastlake Cheer Booster Club', url: 'https://eastlakecheer.org', enabled: true },
            { club: 'Eastlake Choir', url: 'https://eastlakechoir.org', enabled: true },
            { club: 'Eastlake Cross-Country Boosters', url: 'https://eastlakecrosscountry.org', enabled: true },
            { club: 'Eastlake Dance Team Boosters', url: 'https://eastlakedanceteam.org', enabled: true },
            { club: 'EHS DECA Booster Club', url: 'https://ehsdeca.org', enabled: true },
            { club: 'Eastlake Drama', url: 'https://eastlakedrama.org', enabled: true },
            { club: 'Eastlake Fastpitch (Girls)', url: 'https://eastlakefastpitch.org', enabled: true },
            { club: 'Eastlake Boys Golf Booster Club', url: 'https://eastlakeboysgolf.org', enabled: true },
            { club: 'Eastlake Girls Golf Booster Club', url: 'https://eastlakegirlsgolf.org', enabled: true },
            { club: 'EHS Orchestra Boosters Club', url: 'https://ehsorchestra.org', enabled: true },
            { club: 'Eastlake Robotics Club', url: 'https://eastlakerobotics.org', enabled: true },
            { club: 'Eastlake Boys Soccer', url: 'https://eastlakeboyssoccer.org', enabled: true },
            { club: 'Eastlake Girls Soccer', url: 'https://eastlakegirlssoccer.org', enabled: true },
            { club: 'Eastlake Boys Swim & Dive Booster Club', url: 'https://eastlakeboysswim.org', enabled: true },
            { club: 'Eastlake Girls Swim & Dive Booster Club', url: 'https://eastlakegirlsswim.org', enabled: true },
            { club: 'EHS Track and Field Booster Club', url: 'https://ehstrackandfield.org', enabled: true },
            { club: 'Eastlake Volleyball Booster Club', url: 'https://eastlakevolleyball.org', enabled: true },
            { club: 'EHS Wrestling Booster Club', url: 'https://ehswrestling.org', enabled: true }
        ];
        
        function updateWebsiteLink() {
            const clubSelect = document.getElementById('websiteClubSelect');
            const urlInput = document.getElementById('websiteUrl');
            const enabledCheckbox = document.getElementById('websiteEnabled');
            
            const selectedClub = clubSelect.value;
            const newUrl = urlInput.value.trim();
            const enabled = enabledCheckbox.checked;
            
            if (!selectedClub) {
                alert('Please select a club.');
                return;
            }
            
            if (!newUrl) {
                alert('Please enter a website URL.');
                return;
            }
            
            // Update the website links array
            const linkIndex = websiteLinks.findIndex(link => link.club === selectedClub);
            if (linkIndex !== -1) {
                websiteLinks[linkIndex].url = newUrl;
                websiteLinks[linkIndex].enabled = enabled;
            } else {
                websiteLinks.push({
                    club: selectedClub,
                    url: newUrl,
                    enabled: enabled
                });
            }
            
            // Update the display
            displayWebsiteLinks();
            
            alert('Website link updated successfully!');
            
            // Clear form
            urlInput.value = '';
            enabledCheckbox.checked = true;
        }
        
        function displayWebsiteLinks() {
            const tbody = document.getElementById('websiteLinksTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = websiteLinks.map(link => `
                <tr>
                    <td>${link.club}</td>
                    <td><a href="${link.url}" target="_blank">${link.url}</a></td>
                    <td><span class="status-${link.enabled ? 'active' : 'inactive'}">${link.enabled ? 'Active' : 'Disabled'}</span></td>
                    <td>
                        <button class="btn-small" onclick="editWebsiteLink('${link.club}')">Edit</button>
                        <button class="btn-small" onclick="toggleWebsiteLink('${link.club}', ${link.enabled})">${link.enabled ? 'Disable' : 'Enable'}</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function editWebsiteLink(clubName) {
            const link = websiteLinks.find(l => l.club === clubName);
            if (!link) return;
            
            const clubSelect = document.getElementById('websiteClubSelect');
            const urlInput = document.getElementById('websiteUrl');
            const enabledCheckbox = document.getElementById('websiteEnabled');
            
            clubSelect.value = clubName;
            urlInput.value = link.url;
            enabledCheckbox.checked = link.enabled;
            
            // Scroll to the form
            document.getElementById('club-websites').scrollIntoView({ behavior: 'smooth' });
        }
        
        function toggleWebsiteLink(clubName, currentStatus) {
            const link = websiteLinks.find(l => l.club === clubName);
            if (!link) return;
            
            link.enabled = !currentStatus;
            displayWebsiteLinks();
            
            alert(`Website link for ${clubName} has been ${link.enabled ? 'enabled' : 'disabled'}.`);
        }
        
        // Add event listener for users section
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // Check for first login setup
            checkFirstLogin();
            
            // Add event listener for users section
            const usersLink = document.querySelector('a[data-section="users"]');
            if (usersLink) {
                usersLink.addEventListener('click', function() {
                    loadUsersData();
                });
            }
            
            // Add event listener for profile section
            const profileLink = document.querySelector('a[data-section="profile"]');
            if (profileLink) {
                profileLink.addEventListener('click', function() {
                    checkFirstLogin();
                });
            }
            
            // Add event listener for officers section
            const officersLink = document.querySelector('a[data-section="officers"]');
            if (officersLink) {
                officersLink.addEventListener('click', function() {
                    loadOfficersData();
                });
            }
            
            // Add event listener for website links section
            const websiteLinksLink = document.querySelector('a[data-section="club-websites"]');
            if (websiteLinksLink) {
                websiteLinksLink.addEventListener('click', function() {
                    displayWebsiteLinks();
                });
            }
            
                    // Initialize website links display
        displayWebsiteLinks();
        
        // Add event listener for analytics section
        const analyticsLink = document.querySelector('a[data-section="analytics"]');
        if (analyticsLink) {
            analyticsLink.addEventListener('click', function() {
                loadAnalyticsData();
            });
        }
    });
    
    // Analytics & Reports Functions
    
    // Load analytics data
    function loadAnalyticsData() {
        // Load basic analytics data
        fetch('/api/analytics/overview')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateAnalyticsDisplay(data);
                } else {
                    console.error('Error loading analytics:', data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
    
    // Update analytics display
    function updateAnalyticsDisplay(data) {
        // Update the dashboard cards with real data
        const pageViewsElement = document.querySelector('#analytics .dashboard-card:nth-child(1) .stat-number');
        const uniqueVisitorsElement = document.querySelector('#analytics .dashboard-card:nth-child(2) .stat-number');
        const popularPageElement = document.querySelector('#analytics .dashboard-card:nth-child(3) .stat-number');
        const topLinkElement = document.querySelector('#analytics .dashboard-card:nth-child(4) .stat-number');
        
        if (pageViewsElement) pageViewsElement.textContent = data.pageViews || '0';
        if (uniqueVisitorsElement) uniqueVisitorsElement.textContent = data.uniqueVisitors || '0';
        if (popularPageElement) popularPageElement.textContent = data.popularPage || 'Home';
        if (topLinkElement) topLinkElement.textContent = data.topLink || 'None';
    }
    
    // Generate report
    function generateReport() {
        const reportType = document.getElementById('reportType').value;
        const dateRange = document.getElementById('reportDateRange').value;
        
        if (!reportType) {
            alert('Please select a report type.');
            return;
        }
        
        // Show loading state
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Generating...';
        button.disabled = true;
        
        fetch('/api/analytics/report', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                type: reportType,
                dateRange: parseInt(dateRange)
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Create and download the report
                downloadReport(data.report, reportType, dateRange);
            } else {
                alert('Error generating report: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error generating report. Please try again.');
        })
        .finally(() => {
            // Restore button state
            button.textContent = originalText;
            button.disabled = false;
        });
    }
    
    // Download report
    function downloadReport(reportData, type, dateRange) {
        let filename = `ewa_report_${type}_${dateRange}days_${new Date().toISOString().split('T')[0]}.csv`;
        let csvContent = '';
        
        switch (type) {
            case 'usage':
                csvContent = generateUsageReport(reportData);
                break;
            case 'links':
                csvContent = generateLinksReport(reportData);
                break;
            case 'officers':
                csvContent = generateOfficersReport(reportData);
                break;
            case 'documents':
                csvContent = generateDocumentsReport(reportData);
                break;
            default:
                alert('Unknown report type');
                return;
        }
        
        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        alert('Report generated and downloaded successfully!');
    }
    
    // Generate usage report CSV
    function generateUsageReport(data) {
        let csv = 'Date,Page Views,Unique Visitors,Most Popular Page\n';
        data.forEach(row => {
            csv += `${row.date},${row.pageViews},${row.uniqueVisitors},"${row.popularPage}"\n`;
        });
        return csv;
    }
    
    // Generate links report CSV
    function generateLinksReport(data) {
        let csv = 'Link,Club,Clicks,Last Clicked\n';
        data.forEach(row => {
            csv += `"${row.url}","${row.club}",${row.clicks},"${row.lastClicked}"\n`;
        });
        return csv;
    }
    
    // Generate officers report CSV
    function generateOfficersReport(data) {
        let csv = 'Name,Position,Email,Club,Status\n';
        data.forEach(row => {
            csv += `"${row.name}","${row.position}","${row.email}","${row.club}","${row.status}"\n`;
        });
        return csv;
    }
    
    // Generate documents report CSV
    function generateDocumentsReport(data) {
        let csv = 'Type,Club,Submitted Date,Status\n';
        data.forEach(row => {
            csv += `"${row.type}","${row.club}","${row.submittedDate}","${row.status}"\n`;
        });
        return csv;
    }
    
    // Payment amount validation function
    function validatePaymentAmount(input) {
        const value = input.value;
        const errorDiv = document.getElementById('amountError');
        
        // Clear previous error
        errorDiv.style.display = 'none';
        
        // Check if empty
        if (!value) {
            return true; // Let HTML5 validation handle required field
        }
        
        // Check if it's a valid number
        const numValue = parseFloat(value);
        if (isNaN(numValue)) {
            errorDiv.textContent = 'Please enter a valid number';
            errorDiv.style.display = 'block';
            return false;
        }
        
        // Check if it's negative
        if (numValue < 0) {
            errorDiv.textContent = 'Payment amount cannot be negative';
            errorDiv.style.display = 'block';
            return false;
        }
        
        // Check if it has more than 2 decimal places
        const decimalPlaces = (value.split('.')[1] || '').length;
        if (decimalPlaces > 2) {
            errorDiv.textContent = 'Payment amount can have maximum 2 decimal places';
            errorDiv.style.display = 'block';
            return false;
        }
        
        // Check if it's too large (prevent overflow)
        if (numValue > 999999999.99) {
            errorDiv.textContent = 'Payment amount is too large';
            errorDiv.style.display = 'block';
            return false;
        }
        
        return true;
    }
    
    // Participant count validation function
    function validateParticipantCount(input) {
        const value = input.value;
        const errorDiv = document.getElementById('participantCountError');
        
        // Clear previous error
        errorDiv.style.display = 'none';
        
        // Check if empty
        if (!value) {
            return true; // Let HTML5 validation handle required field
        }
        
        // Check if it's a valid integer
        const intValue = parseInt(value);
        if (isNaN(intValue)) {
            errorDiv.textContent = 'Please enter a valid number';
            errorDiv.style.display = 'block';
            return false;
        }
        
        // Check if it's less than 1
        if (intValue < 1) {
            errorDiv.textContent = 'Participant count must be at least 1';
            errorDiv.style.display = 'block';
            return false;
        }
        
        // Check if it's too large (prevent overflow)
        if (intValue > 999999) {
            errorDiv.textContent = 'Participant count is too large';
            errorDiv.style.display = 'block';
            return false;
        }
        
        return true;
    }
    
    // Initialize page data when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Page loaded, initializing data...');
        
        // Check if user is logged in and not logging out before loading data
        const currentUser = userSession.currentUser || {};
        if (!currentUser.username || window.isLoggingOut) {
            console.log('‚ö†Ô∏è User not logged in or logging out, skipping data loading');
            return;
        }
        
        // Handle hash navigation for direct links
        const hash = window.location.hash.substring(1); // Remove the # symbol
        
        // Only load default data if no specific section is requested
        if (!hash) {
            // Load 1099 data automatically for dashboard overview
            load1099Data();
            
            // Load insurance data automatically
            loadInsuranceData();
        }
        if (hash) {
            // Check if user is logged in and not logging out before loading data
            const currentUser = userSession.currentUser || {};
            if (!currentUser.username || window.isLoggingOut) {
                console.log('‚ö†Ô∏è User not logged in or logging out, skipping initial hash navigation data loading');
                return;
            }
            const targetLink = document.querySelector(`a[data-section="${hash}"]`);
            if (targetLink) {
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to target link
                targetLink.classList.add('active');
                
                // Show target section
                const targetSection = document.getElementById(hash);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                
                // Load section-specific data if needed
                switch(hash) {
                    case 'officers':
                        loadOfficersData();
                        break;
                    case 'club-websites':
                        displayWebsiteLinks();
                        break;
                    case 'volunteers':
                        loadVolunteerData();
                        break;
                    case 'news':
                        loadNewsData();
                        break;
                    case 'links':
                        loadLinksData();
                        break;
                    case 'insurance':
                        loadInsuranceData();
                        break;
                    case '1099':
                        load1099Data();
                        break;
                    case 'analytics':
                        loadAnalyticsData();
                        break;
                    case 'content':
                        loadContentData();
                        break;
                    case 'users':
                        loadUsersData();
                        break;
                    case 'profile':
                        checkFirstLogin();
                        break;

                }
            }
        }
        
        console.log('‚úÖ Page initialization complete');
        

        
        // Listen for hash changes (browser back/forward buttons, programmatic changes)
        window.addEventListener('hashchange', function() {
            // Check if user is still logged in and not logging out before loading data
            const currentUser = userSession.currentUser || {};
            if (!currentUser.username || window.isLoggingOut) {
                console.log('‚ö†Ô∏è User not logged in or logging out, skipping hash navigation data loading');
                return;
            }
            
            const hash = window.location.hash.substring(1);
            if (hash) {
                const targetLink = document.querySelector(`a[data-section="${hash}"]`);
                if (targetLink) {
                    // Remove active class from all links and sections
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                    
                    // Add active class to target link
                    targetLink.classList.add('active');
                    
                    // Show target section
                    const targetSection = document.getElementById(hash);
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    // Load section-specific data if needed
                    switch(hash) {
                        case 'officers':
                            loadOfficersData();
                            break;
                        case 'club-websites':
                            displayWebsiteLinks();
                            break;
                        case 'volunteers':
                            loadVolunteerData();
                            break;
                        case 'news':
                            loadNewsData();
                            break;
                        case 'links':
                            loadLinksData();
                            break;
                        case 'insurance':
                            loadInsuranceData();
                            break;
                        case '1099':
                            load1099Data();
                            break;
                        case 'analytics':
                            loadAnalyticsData();
                            break;
                        case 'content':
                            loadContentData();
                            break;
                        case 'users':
                            loadUsersData();
                            break;
                        case 'profile':
                            checkFirstLogin();
                            break;

                    }
                }
            }
        });
    });

    // Helper function to get booster club display name
    function getBoosterClubDisplayName(boosterClub) {
        const clubNames = {
            'band': 'EHS Band Boosters',
            'baseball': 'Eastlake Baseball Club',
            'boys-basketball': 'Eastlake Boys Basketball Booster Club',
            'girls-basketball': 'Eastlake Girls Basketball Booster Club',
            'cheer': 'Eastlake Cheer Booster Club',
            'choir': 'Eastlake Choir',
            'cross-country': 'Eastlake Cross-Country Boosters',
            'dance': 'Eastlake Dance Team Boosters',
            'deca': 'EHS DECA Booster Club',
            'drama': 'Eastlake Drama',
            'fastpitch': 'Eastlake Fastpitch (Girls)',
            'boys-golf': 'Eastlake Boys Golf Booster Club',
            'girls-golf': 'Eastlake Girls Golf Booster Club',
            'orchestra': 'EHS Orchestra Boosters Club',
            'robotics': 'Eastlake Robotics Club',
            'boys-soccer': 'Eastlake Boys Soccer',
            'girls-soccer': 'Eastlake Girls Soccer',
            'boys-swim': 'Eastlake Boys Swim & Dive Booster Club',
            'girls-swim': 'Eastlake Girls Swim & Dive Booster Club',
            'track': 'EHS Track and Field Booster Club',
            'volleyball': 'Eastlake Volleyball Booster Club',
            'wrestling': 'EHS Wrestling Booster Club'
        };
        return clubNames[boosterClub] || boosterClub || 'N/A';
    }

    // Toggle select all checkboxes
    function toggleSelectAll1099() {
        console.log('üîÑ Toggle select all called');
        const selectAllCheckbox = document.getElementById('selectAll1099');
        const checkboxes = document.querySelectorAll('.checkbox-1099');
        
        console.log('üìã Found checkboxes:', checkboxes.length);
        console.log('‚úÖ Select all checkbox checked:', selectAllCheckbox.checked);
        
        checkboxes.forEach((checkbox, index) => {
            checkbox.checked = selectAllCheckbox.checked;
            console.log(`üìù Checkbox ${index + 1} set to:`, checkbox.checked);
        });
        
        updateExportButtons();
        updateSelectAllCheckbox();
    }

    // Update export buttons visibility
    function updateExportButtons() {
        console.log('üîß Update export buttons called');
        
        // Use a safer approach to find checked checkboxes
        const allCheckboxes = document.querySelectorAll('.checkbox-1099');
        const checkedCheckboxes = Array.from(allCheckboxes).filter(cb => cb.checked);
        
        const exportBtn = document.getElementById('export1099Btn');
        const downloadW9Btn = document.getElementById('downloadW9Btn');
        
        console.log('üìã Checked checkboxes:', checkedCheckboxes.length);
        console.log('üìä Export button found:', !!exportBtn);
        console.log('üìÅ Download W9 button found:', !!downloadW9Btn);
        
        if (checkedCheckboxes.length > 0) {
            console.log('‚úÖ Showing buttons');
            exportBtn.style.display = 'inline-block';
            downloadW9Btn.style.display = 'inline-block';
        } else {
            console.log('‚ùå Hiding buttons');
            exportBtn.style.display = 'none';
            downloadW9Btn.style.display = 'none';
        }
        
        updateSelectAllCheckbox();
    }

    // Update select all checkbox state
    function updateSelectAllCheckbox() {
        const selectAllCheckbox = document.getElementById('selectAll1099');
        const checkboxes = document.querySelectorAll('.checkbox-1099');
        const checkedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);
        
        if (checkboxes.length === 0) {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
        } else if (checkedCheckboxes.length === 0) {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
        } else if (checkedCheckboxes.length === checkboxes.length) {
            selectAllCheckbox.checked = true;
            selectAllCheckbox.indeterminate = false;
        } else {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = true;
        }
    }

    // Filter 1099 data by year
    function filter1099ByYear() {
        const yearFilter = document.getElementById('yearFilter').value;
        const currentSubmissions = window.current1099Submissions || [];
        
        if (!yearFilter) {
            display1099Data(currentSubmissions);
        } else {
            const filteredSubmissions = currentSubmissions.filter(sub => 
                sub.tax_year.toString() === yearFilter
            );
            display1099Data(filteredSubmissions);
        }
    }

    // Update 1099 status
    async function update1099Status(formId, status) {
        try {
            const response = await fetch(`/api/1099/${formId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status })
            });
            
            const data = await response.json();
            
            if (data.success) {
                console.log('‚úÖ Status updated successfully');
                // Optionally refresh the data
                load1099Data();
            } else {
                alert('Error updating status: ' + data.message);
            }
        } catch (error) {
            console.error('Error updating status:', error);
            alert('Error updating status. Please try again.');
        }
    }

    // Export selected 1099 data
    async function exportSelected1099() {
        const allCheckboxes = document.querySelectorAll('.checkbox-1099');
        const checkedCheckboxes = Array.from(allCheckboxes).filter(cb => cb.checked);
        const submissionIds = checkedCheckboxes.map(cb => cb.value);
        
        if (submissionIds.length === 0) {
            alert('Please select at least one submission to export');
            return;
        }
        
        try {
            const response = await fetch('/api/1099/export', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ submissionIds, format: 'csv' })
            });
            
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `1099-submissions-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } else {
                const data = await response.json();
                alert('Error exporting data: ' + data.message);
            }
        } catch (error) {
            console.error('Error exporting data:', error);
            alert('Error exporting data. Please try again.');
        }
    }

    // Download selected W9 files
    async function downloadSelectedW9() {
        const allCheckboxes = document.querySelectorAll('.checkbox-1099');
        const checkedCheckboxes = Array.from(allCheckboxes).filter(cb => cb.checked);
        const submissionIds = checkedCheckboxes.map(cb => cb.value);
        
        if (submissionIds.length === 0) {
            alert('Please select at least one submission to download W9 files');
            return;
        }
        
        try {
            const response = await fetch('/api/1099/download-w9', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ submissionIds })
            });
            
            const data = await response.json();
            
            if (data.success) {
                // For now, we'll download files individually
                // In a full implementation, this would create a zip file
                data.files.forEach(file => {
                    const a = document.createElement('a');
                    a.href = file.w9BlobUrl;
                    a.download = file.w9Filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                });
                
                alert(`Downloaded ${data.files.length} W9 file(s)`);
            } else {
                alert('Error downloading W9 files: ' + data.message);
            }
        } catch (error) {
            console.error('Error downloading W9 files:', error);
            alert('Error downloading W9 files. Please try again.');
        }
    }

    // Delete 1099 submission
    async function delete1099Submission(formId, recipientName) {
        if (!confirm(`Are you sure you want to delete the 1099 submission for ${recipientName}?`)) {
            return;
        }
        
        try {
            const response = await fetch(`/api/1099/${formId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('1099 submission deleted successfully');
                load1099Data();
            } else {
                alert('Error deleting submission: ' + data.message);
            }
        } catch (error) {
            console.error('Error deleting submission:', error);
            alert('Error deleting submission. Please try again.');
        }
    }

    // Edit 1099 submission
    async function edit1099Submission(formId) {
        try {
            // Find the submission in the current data
            const submission = window.current1099Submissions.find(sub => sub.id === formId);
            if (!submission) {
                alert('Submission not found');
                return;
            }

            // Create a modal for editing
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3>Edit 1099 Submission</h3>
                    <form id="edit1099Form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Recipient Name *</label>
                            <input type="text" id="editRecipientName" value="${submission.recipient_name || ''}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tax ID *</label>
                            <input type="text" id="editRecipientTin" value="${submission.recipient_tin || ''}" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Amount *</label>
                            <input type="number" id="editAmount" value="${submission.amount || ''}" step="0.01" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Description</label>
                            <textarea id="editDescription" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 60px;">${submission.description || ''}</textarea>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Calendar Year *</label>
                            <select id="editTaxYear" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="2024" ${submission.tax_year === 2024 ? 'selected' : ''}>2024</option>
                                <option value="2025" ${submission.tax_year === 2025 ? 'selected' : ''}>2025</option>
                                <option value="2026" ${submission.tax_year === 2026 ? 'selected' : ''}>2026</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Booster Club *</label>
                            <select id="editBoosterClub" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">Select Booster Club</option>
                                <option value="EWA Eastlake Wolfpack Association" ${submission.booster_club === 'EWA Eastlake Wolfpack Association' ? 'selected' : ''}>EWA Eastlake Wolfpack Association</option>
                                <option value="EHS Band Boosters" ${submission.booster_club === 'EHS Band Boosters' ? 'selected' : ''}>EHS Band Boosters</option>
                                <option value="Eastlake Baseball Club" ${submission.booster_club === 'Eastlake Baseball Club' ? 'selected' : ''}>Eastlake Baseball Club</option>
                                <option value="Eastlake Boys Basketball Booster Club" ${submission.booster_club === 'Eastlake Boys Basketball Booster Club' ? 'selected' : ''}>Eastlake Boys Basketball Booster Club</option>
                                <option value="Eastlake Girls Basketball Booster Club" ${submission.booster_club === 'Eastlake Girls Basketball Booster Club' ? 'selected' : ''}>Eastlake Girls Basketball Booster Club</option>
                                <option value="Eastlake Cheer Booster Club" ${submission.booster_club === 'Eastlake Cheer Booster Club' ? 'selected' : ''}>Eastlake Cheer Booster Club</option>
                                <option value="Eastlake Choir" ${submission.booster_club === 'Eastlake Choir' ? 'selected' : ''}>Eastlake Choir</option>
                                <option value="Eastlake Cross-Country Boosters" ${submission.booster_club === 'Eastlake Cross-Country Boosters' ? 'selected' : ''}>Eastlake Cross-Country Boosters</option>
                                <option value="Eastlake Dance Team Boosters" ${submission.booster_club === 'Eastlake Dance Team Boosters' ? 'selected' : ''}>Eastlake Dance Team Boosters</option>
                                <option value="EHS DECA Booster Club" ${submission.booster_club === 'EHS DECA Booster Club' ? 'selected' : ''}>EHS DECA Booster Club</option>
                                <option value="Eastlake Drama" ${submission.booster_club === 'Eastlake Drama' ? 'selected' : ''}>Eastlake Drama</option>
                                <option value="Eastlake Fastpitch (Girls)" ${submission.booster_club === 'Eastlake Fastpitch (Girls)' ? 'selected' : ''}>Eastlake Fastpitch (Girls)</option>
                                <option value="Eastlake Boys Golf Booster Club" ${submission.booster_club === 'Eastlake Boys Golf Booster Club' ? 'selected' : ''}>Eastlake Boys Golf Booster Club</option>
                                <option value="Eastlake Girls Golf Booster Club" ${submission.booster_club === 'Eastlake Girls Golf Booster Club' ? 'selected' : ''}>Eastlake Girls Golf Booster Club</option>
                                <option value="EHS Orchestra Boosters Club" ${submission.booster_club === 'EHS Orchestra Boosters Club' ? 'selected' : ''}>EHS Orchestra Boosters Club</option>
                                <option value="Eastlake Robotics Club" ${submission.booster_club === 'Eastlake Robotics Club' ? 'selected' : ''}>Eastlake Robotics Club</option>
                                <option value="Eastlake Boys Soccer" ${submission.booster_club === 'Eastlake Boys Soccer' ? 'selected' : ''}>Eastlake Boys Soccer</option>
                                <option value="Eastlake Girls Soccer" ${submission.booster_club === 'Eastlake Girls Soccer' ? 'selected' : ''}>Eastlake Girls Soccer</option>
                                <option value="Eastlake Boys Swim & Dive Booster Club" ${submission.booster_club === 'Eastlake Boys Swim & Dive Booster Club' ? 'selected' : ''}>Eastlake Boys Swim & Dive Booster Club</option>
                                <option value="Eastlake Girls Swim & Dive Booster Club" ${submission.booster_club === 'Eastlake Girls Swim & Dive Booster Club' ? 'selected' : ''}>Eastlake Girls Swim & Dive Booster Club</option>
                                <option value="EHS Track and Field Booster Club" ${submission.booster_club === 'EHS Track and Field Booster Club' ? 'selected' : ''}>EHS Track and Field Booster Club</option>
                                <option value="Eastlake Volleyball Booster Club" ${submission.booster_club === 'Eastlake Volleyball Booster Club' ? 'selected' : ''}>Eastlake Volleyball Booster Club</option>
                                <option value="EHS Wrestling Booster Club" ${submission.booster_club === 'EHS Wrestling Booster Club' ? 'selected' : ''}>EHS Wrestling Booster Club</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button type="button" onclick="closeEditModal()" style="padding: 8px 16px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 4px; cursor: pointer;">Cancel</button>
                            <button type="submit" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Save Changes</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            // Handle form submission
            document.getElementById('edit1099Form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    recipientName: document.getElementById('editRecipientName').value,
                    recipientTin: document.getElementById('editRecipientTin').value,
                    amount: document.getElementById('editAmount').value,
                    description: document.getElementById('editDescription').value,
                    taxYear: document.getElementById('editTaxYear').value,
                    boosterClub: document.getElementById('editBoosterClub').value
                };

                try {
                    const response = await fetch(`/api/1099/${formId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        alert('1099 submission updated successfully!');
                        closeEditModal();
                        load1099Data(); // Refresh the data
                    } else {
                        alert('Error updating submission: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error updating submission:', error);
                    alert('Error updating submission. Please try again.');
                }
            });

        } catch (error) {
            console.error('Error opening edit modal:', error);
            alert('Error opening edit form. Please try again.');
        }
    }

    // Close edit modal
    function closeEditModal() {
        const modal = document.querySelector('div[style*="position: fixed"]');
        if (modal) {
            modal.remove();
        }
    }

    // Delete 1099 submission
    async function delete1099Submission(formId, recipientName) {
        if (!confirm(`Are you sure you want to delete the 1099 submission for "${recipientName}"? This action cannot be undone.`)) {
            return;
        }

        try {
            const response = await fetch(`/api/1099/${formId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            const data = await response.json();
            
            if (data.success) {
                alert('1099 submission deleted successfully!');
                load1099Data(); // Refresh the data
            } else {
                alert('Error deleting submission: ' + data.message);
            }
        } catch (error) {
            console.error('Error deleting submission:', error);
            alert('Error deleting submission. Please try again.');
        }
    }

    // ===== SECURITY DASHBOARD FUNCTIONS =====
    
    // Load dashboard data
    async function loadSecurityDashboard() {
        try {
            const response = await fetch('/api/security/dashboard');
            const data = await response.json();
            
            if (data.success) {
                updateSecurityScore(data.data.securityScore);
                updateVulnerabilities(data.data.vulnerabilities);
                updateRecommendations(data.data.recommendations);
                updateLastScan(data.data.lastScan);
            }
        } catch (error) {
            console.error('Error loading security dashboard:', error);
        }
    }

    // Update security score
    function updateSecurityScore(score) {
        const scoreElement = document.getElementById('securityScore');
        if (scoreElement) {
            scoreElement.textContent = score;
        }
    }

    // Update vulnerabilities
    function updateVulnerabilities(vulns) {
        const countElement = document.getElementById('vulnerabilityCount');
        const criticalElement = document.getElementById('criticalCount');
        const highElement = document.getElementById('highCount');
        const moderateElement = document.getElementById('moderateCount');
        const lowElement = document.getElementById('lowCount');
        
        if (vulns) {
            const total = (vulns.critical || 0) + (vulns.high || 0) + (vulns.moderate || 0) + (vulns.low || 0);
            
            if (countElement) countElement.textContent = total;
            if (criticalElement) criticalElement.textContent = vulns.critical || 0;
            if (highElement) highElement.textContent = vulns.high || 0;
            if (moderateElement) moderateElement.textContent = vulns.moderate || 0;
            if (lowElement) lowElement.textContent = vulns.low || 0;
        }
    }

    // Update recommendations
    function updateRecommendations(recommendations) {
        const container = document.getElementById('securityRecommendations');
        
        if (!recommendations || recommendations.length === 0) {
            container.innerHTML = '<p>No recommendations available.</p>';
            return;
        }

        let html = '<ul>';
        recommendations.forEach(rec => {
            html += `
                <li>
                    <strong>${rec.priority.toUpperCase()}: ${rec.category}</strong><br>
                    ${rec.message}<br>
                    <em>Action: ${rec.action}</em>
                </li>
            `;
        });
        html += '</ul>';
        
        container.innerHTML = html;
    }

    // Update last scan time
    function updateLastScan(timestamp) {
        if (timestamp) {
            const date = new Date(timestamp);
            console.log('Last security scan:', date.toLocaleString());
        }
    }

    // Run security scan
    async function runSecurityScan() {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'üîç Scanning...';
        button.disabled = true;

        try {
            const response = await fetch('/api/security/scan', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Security scan completed successfully!');
                loadSecurityDashboard(); // Refresh dashboard
            } else {
                alert('Security scan failed: ' + data.message);
            }
        } catch (error) {
            console.error('Error running security scan:', error);
            alert('Error running security scan');
        } finally {
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    // Run test coverage
    async function runTestCoverage() {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'üß™ Running Tests...';
        button.disabled = true;

        try {
            const response = await fetch('/api/security/test-coverage', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(`Test coverage completed!\nPassed: ${data.data.passedTests}\nFailed: ${data.data.failedTests}\nCoverage: ${data.data.coverage}%`);
                loadCoverageData();
            } else {
                alert('Test coverage failed: ' + data.message);
            }
        } catch (error) {
            console.error('Error running test coverage:', error);
            alert('Error running test coverage');
        } finally {
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    // Load coverage data
    async function loadCoverageData() {
        try {
            const response = await fetch('/api/security/coverage');
            const data = await response.json();
            
            if (data.success) {
                updateCoverage(data.data.overallCoverage);
            }
        } catch (error) {
            console.error('Error loading coverage:', error);
        }
    }

    // Update coverage display
    function updateCoverage(coverage) {
        const container = document.getElementById('codeCoverage');
        if (container) {
            container.textContent = coverage + '%';
        }
    }

    // View security report
    function viewSecurityReport() {
        window.open('/api/security/report', '_blank');
    }

    // Load security dashboard data when section is shown
    function loadSecurityDashboardData() {
        loadSecurityDashboard();
        loadCoverageData();
    }

    // Add event listener for security dashboard section
    document.addEventListener('DOMContentLoaded', () => {
        // Check if we're on the security dashboard section
        const securitySection = document.getElementById('security-dashboard');
        if (securitySection && securitySection.style.display !== 'none') {
            loadSecurityDashboardData();
        }
    });


</script>
</body>
</html> 